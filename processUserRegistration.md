// ========================================
// Step 1: 사용자 정보 조회 및 계층 구조 구성
// ========================================
// - 이번 배치 등록자 조회 (userIds)
// - 트리 구조 업데이트 (leftChild, rightChild)
// 결과: users (계층 구조 포함)

// ========================================
// Step 2: 등급 재계산 및 월별 인원 관리
// ========================================
// - 전체 사용자 등급 재계산
// - 승급자 추출
// - MonthlyRegistrations 업데이트
//   * 전체 등록자 수
//   * 승급자 수
//   * 미승급자 수
//   * 매출
// 결과: 
//   - promoted (승급자 배열)
//   - monthlyReg (월별 인원 현황)

// ========================================
// Step 3: 지급 대상자 확정 및 등급별 인원 구성
// ========================================
// 3-1. 지급 대상자 3가지 확정
//      - 승급자 (promoted) ← Step 2에서 받음
//      - 미승급 등록자 (monthlyReg에서 계산)
//      - 추가지급 대상자 (조건 확인)
//
// 3-2. 등급별 지급 대상 인원 집계
//      - gradeDistribution: { F1: 4, F2: 2, ... }
//
// 3-3. 등급별 1회 지급 금액 산출
//      - 매출: monthlyReg.totalRevenue
//      - 인원: gradeDistribution
//      - 결과: gradePayments (등급별 금액)
//
// 결과:
//   - promotedTargets (승급자 - 지급 대상)
//   - registrantF1Targets (미승급 등록자 - 지급 대상)
//   - additionalTargets (추가지급 대상)
//   - gradeDistribution (등급별 인원)
//   - gradePayments (등급별 금액)

// ========================================
// Step 4: 지급 계획 생성
// ========================================
// 4-1. 이번 배치 등록자 계획 생성
//      - 미승급자: F1 Initial 계획
//      - 승급자: 
//        * oldGrade Initial 계획
//        * newGrade Promotion 계획
//
// 4-2. 기존 사용자 중 승급자 계획 생성
//      - newGrade Promotion 계획
//      - 기존 추가지급 계획 중단
//
// 4-3. 추가지급 대상자 계획 생성
//      - Additional 계획 (10회)
//
// 결과:
//   - registrantPlans (등록자 계획)
//   - promotionPlans (승급자 계획)
//   - additionalPlans (추가지급 계획)

// ========================================
// Step 5: WeeklyPaymentSummary 업데이트
// ========================================
// - 생성된 모든 계획의 installments를 주차별로 집계
// - 각 주차별 WeeklyPaymentSummary 생성/업데이트
//   * byGrade: 등급별 인원, 금액
//   * totalAmount, totalTax, totalNet
//
// 결과: WeeklyPaymentSummary 업데이트

// ========================================
// Step 6: 처리 완료
// ========================================
// - 결과 반환