# ë°±ì—… ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2025-10-26
**ë²„ì „**: v1.0
**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ (UI ì œì™¸)

---

## ğŸ“‹ êµ¬í˜„ ë‚´ìš©

### 1. ë°±ì—… ì•± ê°œë°œ (apps/backup/)

#### ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
apps/backup/
â”œâ”€â”€ package.json
â”œâ”€â”€ build.sh
â”œâ”€â”€ README.md
â””â”€â”€ src/
    â”œâ”€â”€ index.js          # ë©”ì¸ ì§„ì…ì 
    â”œâ”€â”€ config.js         # MongoDB ì—°ê²° ë° ì„¤ì • ì½ê¸°
    â”œâ”€â”€ backup.js         # mongodump ì‹¤í–‰ ë° ì••ì¶•
    â””â”€â”€ storage/
        â”œâ”€â”€ s3.js         # AWS S3 ì—…ë¡œë“œ
        â””â”€â”€ ftp.js        # FTP ì—…ë¡œë“œ
```

#### ì£¼ìš” ê¸°ëŠ¥
- âœ… MongoDB ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… (mongodump)
- âœ… tar.gz ì••ì¶•
- âœ… AWS S3 ì—…ë¡œë“œ (ì„ íƒ)
- âœ… FTP ì—…ë¡œë“œ (ì„ íƒ)
- âœ… ë³´ê´€ ì •ì±… (ê°œìˆ˜/ë‚ ì§œ ê¸°ë°˜)
- âœ… DB ê¸°ë°˜ ì„¤ì • ì½ê¸°
- âœ… Bun ë‹¨ì¼ ì‹¤í–‰ íŒŒì¼ ë¹Œë“œ

#### ë¹Œë“œ í”„ë¡œì„¸ìŠ¤
```bash
cd apps/backup
./build.sh
# ê²°ê³¼: build/nanumpay-backup (~25MB)
```

### 2. ë¹Œë“œ í†µí•© (apps/web/scripts/release-linux.cjs)

#### ë³€ê²½ ì‚¬í•­
1. **binDir ìƒì„±**: `/opt/nanumpay/bin/` ë””ë ‰í† ë¦¬ ì¶”ê°€
2. **ë°±ì—… ì•± ë¹Œë“œ**: release:linux ì‹¤í–‰ ì‹œ ìë™ ë¹Œë“œ
3. **ì‹¤í–‰ íŒŒì¼ í¬í•¨**: DEB íŒ¨í‚¤ì§€ì— nanumpay-backup í¬í•¨
4. **postinst ìˆ˜ì •**: ë°±ì—… ë””ë ‰í† ë¦¬ ë° ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±
5. **prerm ìˆ˜ì •**: crontab ì •ë¦¬ ì¶”ê°€

#### ì„¤ì¹˜ ê²½ë¡œ
```
/opt/nanumpay/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ nanumpay-backup      # ë°±ì—… ì‹¤í–‰ íŒŒì¼
â”œâ”€â”€ backups/                 # ë°±ì—… ì €ì¥ì†Œ
â”œâ”€â”€ logs/                    # ë¡œê·¸ ë””ë ‰í† ë¦¬
â””â”€â”€ tools/
    â””â”€â”€ db_init.sh
```

### 3. ë°ì´í„° ëª¨ë¸ ìˆ˜ì • (Admin.js)

#### ê¸°ì¡´ êµ¬ì¡° (ë³€ê²½ ì „)
```javascript
systemSettings: {
  backup: {
    enabled: Boolean,
    frequency: String,  // 'daily', 'weekly', 'monthly'
    time: String,       // 'HH:mm'
    storage: { type, s3, ftp }
  }
}
```

#### ìƒˆ êµ¬ì¡° (ë³€ê²½ í›„) â­
```javascript
systemSettings: {
  backupSettings: {
    enabled: Boolean,
    schedule: String,           // cron í˜•ì‹: '0 2 * * *'
    backupPath: String,         // '/opt/nanumpay/backups'
    retentionDays: Number,      // 7ì¼
    retentionCount: Number,     // 5ê°œ
    s3: {
      enabled: Boolean,
      bucket: String,
      accessKeyId: String,
      secretAccessKey: String,
      region: String,           // 'us-east-1'
      prefix: String            // 'backups/'
    },
    ftp: {
      enabled: Boolean,
      host: String,
      port: Number,             // 21
      user: String,
      password: String,
      remotePath: String        // '/backups'
    }
  }
}
```

### 4. ë°°í¬ í†µí•©

#### ë¹Œë“œ ëª…ë ¹ì–´
```bash
# ê¸°ì¡´ ë°©ì‹ê³¼ ë™ì¼
pnpm release:linux

# ìë™ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ì‘ì—…:
# 1. SvelteKit ì•± ë¹Œë“œ (dist/nanumpay)
# 2. ë°±ì—… ì•± ë¹Œë“œ (apps/backup/build/nanumpay-backup)
# 3. DEB íŒ¨í‚¤ì§€ ìƒì„± (apps/web/release/*.deb)
```

#### DEB íŒ¨í‚¤ì§€ ë‚´ìš©
```
nanumpay_0.0.1-YYYYMMDD_amd64.deb
â”œâ”€â”€ opt/nanumpay/
â”‚   â”œâ”€â”€ nanumpay              # ì›¹ ì•±
â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â””â”€â”€ nanumpay-backup   # ë°±ì—… ì•±
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â””â”€â”€ db_init.sh
â”‚   â””â”€â”€ db/
â”‚       â””â”€â”€ init.mongo.js
â”œâ”€â”€ etc/nanumpay/
â”‚   â””â”€â”€ nanumpay.env
â”œâ”€â”€ etc/systemd/system/
â”‚   â””â”€â”€ nanumpay.service
â””â”€â”€ DEBIAN/
    â”œâ”€â”€ control
    â”œâ”€â”€ postinst              # ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±
    â”œâ”€â”€ prerm                 # crontab ì •ë¦¬
    â””â”€â”€ conffiles
```

#### postinst ìŠ¤í¬ë¦½íŠ¸ (ì„¤ì¹˜ ì‹œ)
```bash
# ì‚¬ìš©ì ìƒì„±
adduser --system --group --no-create-home nanumpay

# ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì •
mkdir -p /opt/nanumpay/backups
mkdir -p /opt/nanumpay/logs
chown -R nanumpay:nanumpay /opt/nanumpay/backups
chown -R nanumpay:nanumpay /opt/nanumpay/logs
chmod 755 /opt/nanumpay/backups
chmod 755 /opt/nanumpay/logs

# systemd ë“±ë¡ ë° ì‹œì‘
systemctl daemon-reload
systemctl enable nanumpay.service
systemctl start nanumpay.service
```

#### prerm ìŠ¤í¬ë¦½íŠ¸ (ì œê±° ì‹œ)
```bash
# crontab ì •ë¦¬
crontab -u nanumpay -l | grep -v '/opt/nanumpay/bin/nanumpay-backup' | crontab -u nanumpay -

# ì„œë¹„ìŠ¤ ì¤‘ì§€
systemctl stop nanumpay.service
systemctl disable nanumpay.service
```

---

## ğŸ”„ ë°±ì—… ì›Œí¬í”Œë¡œìš°

### ì„¤ì • íë¦„
```
[ê´€ë¦¬ì ì›¹ UI]
    â†“ (ì„¤ì • ì €ì¥)
[MongoDB admins.systemSettings.backupSettings]
    â†“ (ì½ê¸°)
[ë°±ì—… ì•±: /opt/nanumpay/bin/nanumpay-backup]
    â†“ (ì‹¤í–‰)
[ë°±ì—… ìƒì„± â†’ S3/FTP ì—…ë¡œë“œ â†’ ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬]
```

### Crontab ê´€ë¦¬
```
[ì›¹ UIì—ì„œ ë°±ì—… ì„¤ì • í™œì„±í™”]
    â†“
[API: POST /api/admin/backup/schedule]
    â†“
[crontab ë“±ë¡]
    0 2 * * * /opt/nanumpay/bin/nanumpay-backup >> /opt/nanumpay/logs/backup.log 2>&1
    â†“
[ë§¤ì¼ ìƒˆë²½ 2ì‹œ ìë™ ì‹¤í–‰]
```

### ì¦‰ì‹œ ë°±ì—…
```
[ì›¹ UI: "ì¦‰ì‹œ ë°±ì—…" ë²„íŠ¼]
    â†“
[API: POST /api/admin/backup/execute]
    â†“
[ë°±ì—… ì•± ì¦‰ì‹œ ì‹¤í–‰]
    â†“
[ê²°ê³¼ ë°˜í™˜]
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸

#### MongoDB ì„¤ì • í™•ì¸
```bash
mongosh mongodb://localhost:27017/nanumpay --quiet --eval "
db.admins.updateOne({}, {
  \$set: {
    'systemSettings.backupSettings.enabled': true,
    'systemSettings.backupSettings.backupPath': '/tmp/nanumpay-backups-test',
    'systemSettings.backupSettings.retentionDays': 7,
    'systemSettings.backupSettings.retentionCount': 5
  }
})
"
```

#### ë°±ì—… ì•± ë¹Œë“œ ë° ì‹¤í–‰
```bash
# 1. ë¹Œë“œ
cd apps/backup
./build.sh

# 2. ë°±ì—… ì‹¤í–‰
./build/nanumpay-backup

# 3. ê²°ê³¼ í™•ì¸
ls -lh /tmp/nanumpay-backups-test/
# ì˜ˆìƒ ê²°ê³¼: nanumpay-backup-2025-10-26T14-30-00.tar.gz
```

#### ë¡œê·¸ í™•ì¸
```bash
# ì‹¤í–‰ ë¡œê·¸ ì˜ˆì‹œ:
ğŸš€ NanumPay ë°±ì—… ì‹œìŠ¤í…œ ì‹œì‘
==============================
ì‹¤í–‰ ì‹œê°„: 2025-10-26 14:30:00

âœ… MongoDB ì—°ê²° ì„±ê³µ
âœ… ë°±ì—… ì„¤ì • ë¡œë“œ ì™„ë£Œ
   ë°±ì—… ê²½ë¡œ: /tmp/nanumpay-backups-test
   ë³´ê´€ ê¸°ê°„: 7ì¼
   ë³´ê´€ ê°œìˆ˜: 5ê°œ
   S3 ì—…ë¡œë“œ: ë¹„í™œì„±í™”
   FTP ì—…ë¡œë“œ: ë¹„í™œì„±í™”

ğŸ“¦ ë°±ì—… ì‹œì‘: nanumpay-backup-2025-10-26T14-30-00
ğŸ—„ï¸  mongodump ì‹¤í–‰ ì¤‘...
âœ… mongodump ì™„ë£Œ
ğŸ—œï¸  ì••ì¶• ì¤‘...
âœ… ì••ì¶• ì™„ë£Œ: nanumpay-backup-2025-10-26T14-30-00.tar.gz

ğŸ§¹ ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬ ì¤‘...
ğŸ“Š ì „ì²´ ë°±ì—… íŒŒì¼ ìˆ˜: 1ê°œ
ğŸ”¢ ê°œìˆ˜ ê¸°ì¤€ ì‚­ì œ ëŒ€ìƒ: 0ê°œ (ìµœëŒ€ 5ê°œ ìœ ì§€)
ğŸ“… ë‚ ì§œ ê¸°ì¤€ ì‚­ì œ ëŒ€ìƒ: 0ê°œ (7ì¼ ì´ìƒ ê²½ê³¼)
âœ… ì •ë¦¬ ì™„ë£Œ: 0ê°œ íŒŒì¼ ì‚­ì œ
ğŸ“Š ë‚¨ì€ ë°±ì—… íŒŒì¼ ìˆ˜: 1ê°œ

âœ… MongoDB ì—°ê²° ì¢…ë£Œ

==============================
âœ… ë°±ì—… ì™„ë£Œ!
ì¢…ë£Œ ì‹œê°„: 2025-10-26 14:30:05
```

### 2. ë³´ê´€ ì •ì±… í…ŒìŠ¤íŠ¸

```bash
# ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ì—¬ ë°±ì—… íŒŒì¼ ìƒì„±
for i in {1..10}; do
  ./build/nanumpay-backup
  sleep 2
done

# ê°œìˆ˜ ì œí•œ í™•ì¸ (retentionCount: 5)
ls /tmp/nanumpay-backups-test/*.tar.gz | wc -l
# ì˜ˆìƒ ê²°ê³¼: 5ê°œ
```

### 3. S3 ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸

```bash
# S3 ì„¤ì • í™œì„±í™”
mongosh mongodb://localhost:27017/nanumpay --quiet --eval "
db.admins.updateOne({}, {
  \$set: {
    'systemSettings.backupSettings.s3.enabled': true,
    'systemSettings.backupSettings.s3.bucket': 'your-bucket',
    'systemSettings.backupSettings.s3.accessKeyId': 'YOUR_ACCESS_KEY',
    'systemSettings.backupSettings.s3.secretAccessKey': 'YOUR_SECRET_KEY',
    'systemSettings.backupSettings.s3.region': 'us-east-1'
  }
})
"

# ë°±ì—… ì‹¤í–‰
./build/nanumpay-backup

# S3 í™•ì¸
aws s3 ls s3://your-bucket/backups/
```

### 4. FTP ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸

```bash
# FTP ì„¤ì • í™œì„±í™”
mongosh mongodb://localhost:27017/nanumpay --quiet --eval "
db.admins.updateOne({}, {
  \$set: {
    'systemSettings.backupSettings.ftp.enabled': true,
    'systemSettings.backupSettings.ftp.host': 'ftp.example.com',
    'systemSettings.backupSettings.ftp.port': 21,
    'systemSettings.backupSettings.ftp.user': 'username',
    'systemSettings.backupSettings.ftp.password': 'password',
    'systemSettings.backupSettings.ftp.remotePath': '/backups'
  }
})
"

# ë°±ì—… ì‹¤í–‰
./build/nanumpay-backup
```

### 5. í”„ë¡œë•ì…˜ ë°°í¬ í…ŒìŠ¤íŠ¸

```bash
# 1. ë¹Œë“œ
pnpm release:linux

# 2. í™•ì¸
ls -lh apps/web/release/*.deb

# 3. ë°°í¬
node apps/web/scripts/deploy.cjs

# 4. ì„œë²„ì—ì„œ í™•ì¸
ssh -i ~/.ssh/ocp_tyranno tyranno@34.170.107.151

# 5. ë°±ì—… ì•± í™•ì¸
ls -l /opt/nanumpay/bin/nanumpay-backup
/opt/nanumpay/bin/nanumpay-backup

# 6. ë¡œê·¸ í™•ì¸
tail -f /opt/nanumpay/logs/backup.log
```

---

## ğŸ“ ë‚¨ì€ ì‘ì—… (TODO)

### 1. ë°±ì—… ê´€ë¦¬ API êµ¬í˜„ â­ í•„ìˆ˜

#### API ì—”ë“œí¬ì¸íŠ¸
```javascript
// apps/web/src/routes/api/admin/backup/

// 1. ì„¤ì • ì¡°íšŒ
GET /api/admin/backup/settings
â†’ systemSettings.backupSettings ë°˜í™˜

// 2. ì„¤ì • ì €ì¥ + crontab ì—…ë°ì´íŠ¸
POST /api/admin/backup/settings
â†’ DB ì—…ë°ì´íŠ¸ + crontab ë“±ë¡/ì œê±°

// 3. ì¦‰ì‹œ ë°±ì—… ì‹¤í–‰
POST /api/admin/backup/execute
â†’ execSync('/opt/nanumpay/bin/nanumpay-backup')

// 4. ë°±ì—… íŒŒì¼ ëª©ë¡
GET /api/admin/backup/files
â†’ readdir('/opt/nanumpay/backups')

// 5. ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ
GET /api/admin/backup/download/:filename
â†’ createReadStream()

// 6. ë°±ì—… íŒŒì¼ ì‚­ì œ
DELETE /api/admin/backup/files/:filename
â†’ unlink()

// 7. ë¡œê·¸ ì¡°íšŒ
GET /api/admin/backup/logs
â†’ readFile('/opt/nanumpay/logs/backup.log')
```

### 2. ë°±ì—… ì„¤ì • UI êµ¬í˜„ â­ í•„ìˆ˜

#### í™”ë©´ ìœ„ì¹˜
```
/admin/settings â†’ "ë°±ì—… ì„¤ì •" íƒ­ ì¶”ê°€
```

#### UI êµ¬ì„± ìš”ì†Œ
```svelte
<!-- apps/web/src/routes/(admin)/admin/settings/+page.svelte -->

<script>
  let backupSettings = {
    enabled: false,
    schedule: '0 2 * * *',
    backupPath: '/opt/nanumpay/backups',
    retentionDays: 7,
    retentionCount: 5,
    s3: {
      enabled: false,
      bucket: '',
      accessKeyId: '',
      secretAccessKey: '',
      region: 'us-east-1',
      prefix: 'backups/'
    },
    ftp: {
      enabled: false,
      host: '',
      port: 21,
      user: '',
      password: '',
      remotePath: '/backups'
    }
  };

  async function saveSettings() {
    await fetch('/api/admin/backup/settings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(backupSettings)
    });
  }

  async function runBackupNow() {
    await fetch('/api/admin/backup/execute', { method: 'POST' });
  }
</script>

<!-- UI êµ¬ì„± -->
<div class="backup-settings">
  <h2>ë°±ì—… ì„¤ì •</h2>

  <!-- 1. í™œì„±í™” í† ê¸€ -->
  <label>
    <input type="checkbox" bind:checked={backupSettings.enabled} />
    ìë™ ë°±ì—… í™œì„±í™”
  </label>

  <!-- 2. ìŠ¤ì¼€ì¤„ (cron í˜•ì‹) -->
  <input type="text" bind:value={backupSettings.schedule} placeholder="0 2 * * *" />

  <!-- 3. ë³´ê´€ ì •ì±… -->
  <input type="number" bind:value={backupSettings.retentionDays} min="1" />
  <input type="number" bind:value={backupSettings.retentionCount} min="1" />

  <!-- 4. S3 ì„¤ì • (ì ‘ê¸°/í¼ì¹˜ê¸°) -->
  <details>
    <summary>AWS S3 ì—…ë¡œë“œ</summary>
    <label>
      <input type="checkbox" bind:checked={backupSettings.s3.enabled} />
      S3 ì—…ë¡œë“œ í™œì„±í™”
    </label>
    <input type="text" bind:value={backupSettings.s3.bucket} placeholder="ë²„í‚·ëª…" />
    <input type="text" bind:value={backupSettings.s3.accessKeyId} placeholder="Access Key" />
    <input type="password" bind:value={backupSettings.s3.secretAccessKey} placeholder="Secret Key" />
    <input type="text" bind:value={backupSettings.s3.region} placeholder="ë¦¬ì „" />
  </details>

  <!-- 5. FTP ì„¤ì • (ì ‘ê¸°/í¼ì¹˜ê¸°) -->
  <details>
    <summary>FTP ì—…ë¡œë“œ</summary>
    <label>
      <input type="checkbox" bind:checked={backupSettings.ftp.enabled} />
      FTP ì—…ë¡œë“œ í™œì„±í™”
    </label>
    <input type="text" bind:value={backupSettings.ftp.host} placeholder="FTP ì„œë²„" />
    <input type="number" bind:value={backupSettings.ftp.port} placeholder="í¬íŠ¸" />
    <input type="text" bind:value={backupSettings.ftp.user} placeholder="ì‚¬ìš©ìëª…" />
    <input type="password" bind:value={backupSettings.ftp.password} placeholder="ë¹„ë°€ë²ˆí˜¸" />
  </details>

  <!-- 6. ë²„íŠ¼ -->
  <button on:click={saveSettings}>ì„¤ì • ì €ì¥</button>
  <button on:click={runBackupNow}>ì¦‰ì‹œ ë°±ì—…</button>
</div>
```

#### ë°±ì—… íŒŒì¼ ëª©ë¡ UI
```svelte
<div class="backup-files">
  <h3>ë°±ì—… íŒŒì¼ ëª©ë¡</h3>
  <table>
    <thead>
      <tr>
        <th>íŒŒì¼ëª…</th>
        <th>í¬ê¸°</th>
        <th>ìƒì„±ì¼</th>
        <th>ì‘ì—…</th>
      </tr>
    </thead>
    <tbody>
      {#each backupFiles as file}
        <tr>
          <td>{file.name}</td>
          <td>{file.sizeMB} MB</td>
          <td>{file.created}</td>
          <td>
            <button on:click={() => downloadBackup(file.name)}>ë‹¤ìš´ë¡œë“œ</button>
            <button on:click={() => deleteBackup(file.name)}>ì‚­ì œ</button>
          </td>
        </tr>
      {/each}
    </tbody>
  </table>
</div>
```

#### ë¡œê·¸ ë·°ì–´ UI
```svelte
<div class="backup-logs">
  <h3>ë°±ì—… ë¡œê·¸</h3>
  <button on:click={refreshLogs}>ìƒˆë¡œê³ ì¹¨</button>
  <pre>{backupLogs}</pre>
</div>
```

### 3. Crontab ê´€ë¦¬ í—¬í¼ í•¨ìˆ˜

```javascript
// apps/web/src/lib/server/utils/crontab.js

import { execSync } from 'child_process';

export function updateBackupCrontab(schedule) {
  try {
    // í˜„ì¬ crontab ì½ê¸°
    let currentCrontab = '';
    try {
      currentCrontab = execSync('crontab -u nanumpay -l 2>/dev/null', {
        encoding: 'utf8'
      });
    } catch {
      // crontab ì—†ìŒ
    }

    // nanumpay-backup ê´€ë ¨ í•­ëª© ì œê±°
    const lines = currentCrontab
      .split('\n')
      .filter(line => !line.includes('/opt/nanumpay/bin/nanumpay-backup'));

    // ìƒˆ ìŠ¤ì¼€ì¤„ ì¶”ê°€ (í™œì„±í™”ëœ ê²½ìš°)
    if (schedule) {
      const newEntry = `${schedule} /opt/nanumpay/bin/nanumpay-backup >> /opt/nanumpay/logs/backup.log 2>&1`;
      lines.push(newEntry);
    }

    // crontab ì—…ë°ì´íŠ¸
    const newCrontab = lines.filter(l => l.trim()).join('\n') + '\n';
    execSync(`echo "${newCrontab}" | crontab -u nanumpay -`, {
      encoding: 'utf8'
    });

    return true;
  } catch (error) {
    console.error('Crontab ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
    return false;
  }
}
```

---

## ğŸ¯ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë¹Œë“œ ì „ í™•ì¸
- [ ] Bun ì„¤ì¹˜ í™•ì¸: `bun --version`
- [ ] apps/backup/ ì½”ë“œ í™•ì¸
- [ ] Admin ëª¨ë¸ ìŠ¤í‚¤ë§ˆ í™•ì¸

### ë¹Œë“œ
```bash
cd /home/tyranno/project/bill/nanumpay
pnpm release:linux
```

### ë¹Œë“œ í›„ í™•ì¸
- [ ] apps/backup/build/nanumpay-backup ìƒì„± í™•ì¸
- [ ] apps/web/release/*.deb ìƒì„± í™•ì¸
- [ ] DEB íŒ¨í‚¤ì§€ ë‚´ìš© í™•ì¸:
  ```bash
  dpkg-deb -c apps/web/release/nanumpay_*.deb | grep backup
  # ì˜ˆìƒ ê²°ê³¼:
  # ./opt/nanumpay/bin/nanumpay-backup
  ```

### ë°°í¬
```bash
node apps/web/scripts/deploy.cjs
```

### ë°°í¬ í›„ í™•ì¸ (ì„œë²„)
```bash
ssh -i ~/.ssh/ocp_tyranno tyranno@34.170.107.151

# 1. íŒŒì¼ í™•ì¸
ls -l /opt/nanumpay/bin/nanumpay-backup
ls -ld /opt/nanumpay/backups
ls -ld /opt/nanumpay/logs

# 2. ê¶Œí•œ í™•ì¸
ls -l /opt/nanumpay/bin/nanumpay-backup
# -rwxr-xr-x 1 nanumpay nanumpay ... nanumpay-backup

# 3. ì‹¤í–‰ í…ŒìŠ¤íŠ¸
sudo -u nanumpay /opt/nanumpay/bin/nanumpay-backup

# 4. ë¡œê·¸ í™•ì¸
tail -f /opt/nanumpay/logs/backup.log

# 5. ë°±ì—… íŒŒì¼ í™•ì¸
ls -lh /opt/nanumpay/backups/
```

---

## ğŸ” ë¬¸ì œ í•´ê²°

### MongoDB ì—°ê²° ì‹¤íŒ¨
```bash
# MongoDB ìƒíƒœ í™•ì¸
sudo systemctl status mongod

# MongoDB ì¬ì‹œì‘
sudo systemctl restart mongod

# ì—°ê²° í…ŒìŠ¤íŠ¸
mongosh mongodb://localhost:27017/nanumpay
```

### mongodump ëª…ë ¹ ì—†ìŒ
```bash
# MongoDB Database Tools ì„¤ì¹˜
sudo apt-get update
sudo apt-get install mongodb-database-tools
```

### ê¶Œí•œ ì˜¤ë¥˜
```bash
# ë°±ì—… ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
ls -ld /opt/nanumpay/backups

# ê¶Œí•œ ìˆ˜ì •
sudo chown -R nanumpay:nanumpay /opt/nanumpay/backups
sudo chmod 755 /opt/nanumpay/backups
```

### Bun ì„¤ì¹˜
```bash
# Bun ì„¤ì¹˜
curl -fsSL https://bun.sh/install | bash

# ì„¤ì¹˜ í™•ì¸
bun --version
```

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

1. [ë°±ì—… ì‹œìŠ¤í…œ ìµœì¢… ì„¤ê³„](ë°±ì—…_ì‹œìŠ¤í…œ_ìµœì¢…_ì„¤ê³„.md)
2. [ë°±ì—… ì‹œìŠ¤í…œ ë°°í¬ í†µí•©](ë°±ì—…_ì‹œìŠ¤í…œ_ë°°í¬_í†µí•©.md)
3. [ë°±ì—… ì•± README](../apps/backup/README.md)

---

**ì‘ì„±ì**: Claude AI Assistant
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-10-26
