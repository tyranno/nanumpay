# MLM 시스템 요구사항 검토 문서

**버전**: 1.0
**작성일**: 2025년 10월 3일
**목적**: 개발 요구사항 확인 및 검토

---

## 📋 목차

1. [시스템 개요](#1-시스템-개요)
2. [조직 구조 및 등급 시스템](#2-조직-구조-및-등급-시스템)
3. [등록 프로세스](#3-등록-프로세스)
4. [매출 및 수익 배분](#4-매출-및-수익-배분)
5. [지급 제한 규칙](#5-지급-제한-규칙)
6. [운영 프로세스](#6-운영-프로세스)
7. [검토 필요 사항](#7-검토-필요-사항)

---

## 1. 시스템 개요

### 1.1 시스템 목적

MLM(Multi-Level Marketing) 구조 기반 용역자 관리 및 수익 자동 배분 시스템

### 1.2 핵심 기능

- ✅ 이진트리(Binary Tree) 구조로 조직 관리
- ✅ 조직 규모에 따른 8단계 자동 등급 산정 (F1~F8)
- ✅ 매월 신규 가입 인원 기반 매출 계산
- ✅ 등급별 차등 수익 배분 (누적 방식)
- ✅ 10회 분할 지급 (주 단위)

### 1.3 사용자 유형

- **관리자**: 시스템 전체 관리, 용역자 등록/조회, 매출 계산
- **용역자**: 개인 정보 조회, 수익 내역 확인

---

## 2. 조직 구조 및 등급 시스템

### 2.1 이진트리 구조

**기본 원칙:**

- 각 용역자는 최대 2명의 직속 하위자(좌/우)를 보유
- 신규 등록 시 좌측 우선 배치 (L → R)
- 트리 구조 예시:

```
           A (F3)
         /      \
      B (F2)    C (F2)
     /    \    /    \
   D(F1) E(F1) F(F1) G(F1)
```

### 2.2 등급 산정 규칙

| 등급   | 조건                                                                     | 설명                       |
| ------ | ------------------------------------------------------------------------ | -------------------------- |
| **F1** | 하위자 0~1명                                                             | 초기 등급 또는 불완전 노드 |
| **F2** | 좌우 하위자 각 1명씩 보유                                                | 완전 이진 노드             |
| **F3** | 좌우 각각 F2 등급 1명 이상 보유                                          | F2 균형 조직               |
| **F4** | 좌우 각각 F3 등급 1명 이상 보유                                          | F3 균형 조직               |
| **F5** | 전체 조직에 F4 등급 총 3명 이상 보유 `<br>`(좌우 최소 1:2 또는 2:1 이상) | F4 비대칭 조직             |
| **F6** | 전체 조직에 F5 등급 총 3명 이상 보유 `<br>`(좌우 최소 1:2 또는 2:1 이상) | F5 비대칭 조직             |
| **F7** | 전체 조직에 F6 등급 총 3명 이상 보유 `<br>`(좌우 최소 1:2 또는 2:1 이상) | F6 비대칭 조직             |
| **F8** | 전체 조직에 F7 등급 총 3명 이상 보유 `<br>`(좌우 최소 1:2 또는 2:1 이상) | 최고 등급                  |

**등급 계산 방식:**

- 시스템이 자동으로 계산 (실시간)
- 하위 조직 변화 시 상위 조직 등급도 자동 재계산
- 등급 변동에 따른 지급은 익월 지급 부터 적용

### 2.3 실제 조직 예시

#### 예시 1: 8명 조직 (F3까지)

```
                    A (F3)
                  /        \
              B (F2)        C (F2)
             /      \      /      \
          D(F1)  E(F1) F(F1)  G(F1)
```

**등급 산정 과정:**

- D, E, F, G: 하위자 없음 → F1
- B: 좌우 각 F1 보유 → F2
- C: 좌우 각 F1 보유 → F2
- A: 좌우 각 F2 보유 → F3

**등급 분포:**

- F1: 4명 (리프 노드)
- F2: 2명
- F3: 1명 (최상위)

#### 예시 2: 21명 조직 (F4까지)

```
                    1번(F4)
                  /          \
              2번(F3)          3번(F3)
             /      \          /      \
          4번(F2)  5번(F2)  6번(F2)  7번(F2)
         /  \      /  \      /  \      /  \
      8~21번 (모두 F1 등급, 리프 노드)
```

**등급 분포:**

- F1: 14명 (리프 노드)
- F2: 4명
- F3: 2명
- F4: 1명 (최상위)

---

## 3. 등록 프로세스

### 3.1 용역자 등록 방식

용역자는 **2가지 방식**으로 등록 가능합니다:

1. **엑셀 일괄 등록**: 여러 명을 한 번에 등록
2. **개별 등록**: 1명씩 직접 입력

**공통 필수 항목:**

- 성명
- 연락처
- 은행
- 계좌번호
- 판매인(추천인)
- 가입일자
- 설계사 정보

**자동 처리 항목:**

- 로그인 ID: 성명을 소문자로 변환 (중복 시 A, B, C 추가)
- 비밀번호: 전화번호 뒷 4자리 (기본값: 1234)
- 배치 위치: 판매인의 좌측 우선 → 좌측 차있으면 우측

### 3.2 엑셀 일괄 등록

**엑셀 업로드 시 처리:**

1. **1단계**: 모든 용역자를 먼저 시스템에 등록
2. **2단계**: 판매인(추천인) 관계를 바탕으로 트리 구조 연결

### 3.3 개별 등록

**입력 화면:**

- 관리자 페이지에서 "용역자 추가" 기능
- 엑셀과 동일한 항목을 폼으로 입력

**처리 과정:**

1. 필수 항목 입력 (성명, 연락처, 은행, 계좌번호, 판매인, 가입일자, 설계사 정보)
2. 로그인 ID/비밀번호 자동 생성
3. 판매인 검색 및 트리 배치
4. 등급 자동 계산
5. 즉시 시스템에 반영

### 3.4 판매인(추천인) 검색 우선순위

1. **우선순위 1**: 기존에 등록된 용역자 중 이름 검색
2. **우선순위 2**: 같은 엑셀 파일에서 방금 등록된 용역자 중 검색 (일괄 등록 시)

### 3.5 검증 규칙

- ❌ 루트 노드(최상위 용역자)는 1명만 허용
- ❌ 자기 자신을 판매인으로 등록 불가
- ⚠️ 판매인의 좌우 자리가 모두 찬 경우 → 수동 배치 필요 (관리자 알림)

---

## 4. 매출 및 수익 배분

### 4.1 매출 및 지급 기준 (핵심 규칙)

#### 4.1.1 월별 매출 계산

**매출 집계 기간:**

```
매월 1일 00:00:00 ~ 말일 23:59:59
```

**매출 계산 공식:**

```
월 총매출 = 해당 월 신규 가입 인원 × 100만원
```

**예시:**

```
9월 1일~30일 신규 가입: 10명
→ 9월 총매출: 1,000만원
```

**매출 귀속 기준:**

- 엑셀 "날짜" 컬럼의 년/월 기준
- 하나의 엑셀에 여러 달 데이터 포함 가능 → 각 월별로 별도 매출 계산

#### 4.1.2 지급일 및 지급 기준 등급

**지급일:**

```
매주 금요일
```

**등급 기준일 계산:**

```
지급일: N년 M월 D일 (금요일)
등급 기준일: N년 (M-1)월 (D-1)일 최종 등급

단, 전월에 (D-1)일이 없는 경우 → 전월 말일 최종 등급 사용
```

**구체적 예시:**

| 지급일        | 등급 기준일        | 비고                     |
| ------------- | ------------------ | ------------------------ |
| 10월 3일(금)  | 9월 2일 최종 등급  | 정상 케이스              |
| 10월 11일(금) | 9월 10일 최종 등급 | 정상 케이스              |
| 11월 1일(금)  | 9월 30일 최종 등급 | 10월 0일 없음 → 9월 말일 |
| 3월 31일(금)  | 2월 28일 최종 등급 | 2월 30일 없음 → 2월 말일 |

**매출 기준:**

```
지급일: N년 M월 D일 (금요일)
매출 기준: N년 (M-1)월 1일~말일 총매출
```

**종합 예시:**

```
지급일: 2024년 10월 3일 (금요일)
매출 기준: 2024년 9월 1일~30일 총매출
등급 기준: 2024년 9월 2일 23:59:59 최종 등급

홍길동:
- 9월 2일 최종 등급: F2
- 9월 총매출 기준 F2 개인 지급액: 100만원
- 10회 분할: 회차당 10만원
- 10월 3일(금) 지급: 1회차 10만원
```

**중요 원칙:**

- ✅ 같은 매출월이라도 **금요일마다 등급이 다를 수 있음**
- ✅ 각 금요일의 등급 기준일이 다르므로 **개인별 지급액이 회차마다 변동 가능**

### 4.2 등급별 수익 배분 비율

| 등급 | 배분 비율 | 배분 방식                                       |
| ---- | --------- | ----------------------------------------------- |
| F1   | 24%       | (총매출 × 24%) ÷ (F1 + F2 인원)                 |
| F2   | 19%       | **F1 지급액** + (총매출 × 19%) ÷ (F2 + F3 인원) |
| F3   | 14%       | **F2 지급액** + (총매출 × 14%) ÷ (F3 + F4 인원) |
| F4   | 9%        | **F3 지급액** + (총매출 × 9%) ÷ (F4 + F5 인원)  |
| F5   | 5%        | **F4 지급액** + (총매출 × 5%) ÷ (F5 + F6 인원)  |
| F6   | 3%        | **F5 지급액** + (총매출 × 3%) ÷ (F6 + F7 인원)  |
| F7   | 2%        | **F6 지급액** + (총매출 × 2%) ÷ (F7 + F8 인원)  |
| F8   | 1%        | **F7 지급액** + (총매출 × 1%) ÷ F8 인원         |

**누적 방식 예시:**

```
총매출: 1,000만원
F1 인원: 50명, F2 인원: 10명, F3 인원: 4명, F4 인원: 2명

F1 개인 지급액 = (1,000만원 × 24%) ÷ (50+10) = 40,000원
F2 개인 지급액 = 40,000원 + (1,000만원 × 19%) ÷ (10+4) = 175,714원
F3 개인 지급액 = 175,714원 + (1,000만원 × 14%) ÷ (4+2) = 409,047원
```

**100원 단위 절삭:**

- 모든 금액은 100원 단위 절삭
- 예: 409,047원 → 409,000원

### 4.3 등급 변동 시 지급액 계산 (중요)

**핵심 원칙:**

- **매출 발생 월은 고정**, 등급은 **지급일마다 변동 가능**
- 각 금요일마다 해당 금요일의 등급 기준일 등급으로 지급액 재계산

**예시 1: 등급이 유지되는 경우**

```
9월 내내 F2 등급 유지

10월 3일(금): 9월 2일 F2 등급 → F2 금액으로 계산
10월 11일(금): 9월 10일 F2 등급 → F2 금액으로 계산
→ 지급액 동일
```

**예시 2: 등급이 변동된 경우**

```
9월 1일: F2 등급
9월 7일: F3 승급

10월 3일(금): 9월 2일 F2 등급 → F2 금액 10만원
10월 11일(금): 9월 10일 F3 등급 → F3 금액 15만원
→ 같은 9월 매출이지만 회차별 지급액 다름
```

**예시 3: 복잡한 등급 변동**

```
9월 매출: 1,000만원

홍길동 등급 변화:
- 9월 1일~5일: F2
- 9월 6일~20일: F3

10월 3일(금): 9월 2일 = F2 → 10만원
10월 11일(금): 9월 10일 = F3 → 15만원
10월 18일(금): 9월 17일 = F3 → 15만원
```

**기존 규칙과의 차이:**

- ❌ 기존: "매출 발생 월 등급 고정" → 10회 모두 동일 금액
- ✅ 신규: "지급일 기준 전월 등급" → 10회마다 금액 다를 수 있음

### 4.4 10회 분할 지급

**지급 방식:**

- **매주 금요일 지급**
- 매출 발생 익월부터 **연속 10개 금요일** 동안 지급

**예시 1: 등급 고정 시**

```
9월 매출, 9월 내내 F2 등급 유지 → 개인 지급액 100만원

10월 4일(금): 1회차 10만원
10월 11일(금): 2회차 10만원
10월 18일(금): 3회차 10만원
10월 25일(금): 4회차 10만원
11월 1일(금): 5회차 10만원
11월 8일(금): 6회차 10만원
11월 15일(금): 7회차 10만원
11월 22일(금): 8회차 10만원
11월 29일(금): 9회차 10만원
12월 6일(금): 10회차 10만원 (완료)
```

**예시 2: 등급 변동 시**

```
9월 매출, 등급 변동 발생

10월 4일(금): 9월 3일 F2 → 10만원
10월 11일(금): 9월 10일 F3 → 15만원
10월 18일(금): 9월 17일 F3 → 15만원
...

→ 회차별 금액이 다를 수 있음
```

### 4.5 중첩 지급

**여러 달 매출의 동시 지급:**

```
10월 4일(금) 수령 예시:

├─ 7월 매출 7회차:
│  등급 기준: 9월 3일 등급
│  금액: 15,000원
│
├─ 8월 매출 3회차:
│  등급 기준: 9월 3일 등급
│  금액: 20,000원
│
└─ 9월 매출 1회차:
   등급 기준: 9월 3일 등급
   금액: 17,571원

총 수령액: 52,571원
```

**중요:**

- 같은 금요일에 지급되는 **모든 매출의 등급 기준일은 동일**
- 10월 4일(금) → 모두 9월 3일 등급 기준

### 4.6 원천징수

- 지급액의 **3.3% 원천징수**
- 실지급액 = 지급액 × 96.7%

---

### 4.7 등급별 지급금액 고정 설정 (관리자 기능)

**기능:**

- 관리자가 특정 매출월의 **등급별 지급금액을 일괄 지정** 가능
- 자동 계산 무시하고 **고정된 금액으로 10회 분할 지급**

**설정 단위:**

- **등급별 설정**: F1~F8 각 등급별로 금액 지정
- **월별 설정**: 매출 발생 월별로 설정

**예시:**

```
2024년 9월 매출분 등급별 고정 금액 설정:

F1: 50,000원 고정
F2: 150,000원 고정
F3: 350,000원 고정
F4: 600,000원 고정
F5~F8: 미설정 (자동 계산 금액 사용)

적용 결과:
- 9월 F2 등급 모든 용역자: 150,000원 고정
  (자동 계산 175,700원 무시)
- 10월부터 10개 금요일: 회차당 15,000원씩 지급
- 등급 변동해도 9월 매출분은 150,000원 고정 유지
```

**적용 우선순위:**

1. 관리자 고정 금액 (등급별 설정)
2. 자동 계산 금액 (미설정 시)

**적용 범위:**

- 등급별 일괄 적용 (해당 등급의 모든 용역자)
- 특정 매출월에 대해서만 적용
- 일부 등급만 선택 설정 가능

---

## 5. 지급 제한 규칙

### 5.1 등급별 최대 지급 회수

**목적**: 같은 등급이 계속 유지되면 지급 대상에서 제외

| 등급 | 최대 지급 총회수 | 대응 매출 기간  |
| ---- | ---------------- | --------------- |
| F1   | 20회             | 최대 2개월 매출 |
| F2   | 30회             | 최대 3개월 매출 |
| F3   | 40회             | 최대 4개월 매출 |
| F4   | 40회             | 최대 4개월 매출 |
| F5   | 50회             | 최대 5개월 매출 |
| F6   | 50회             | 최대 5개월 매출 |
| F7   | 60회             | 최대 6개월 매출 |
| F8   | 60회             | 최대 6개월 매출 |

**예시:**

```
F1 등급 유지 시:
- 1월 매출 발생 → 2월~3월 10회 지급 (누적 10회)
- 2월 매출 발생 → 3월~4월 10회 지급 (누적 20회) ← 최대치 도달
- 3월 매출 발생 → 지급 대상 제외 (여전히 F1이므로)
```

### 5.2 등급 상승 시 카운터 리셋

**원칙:**

- 등급 상승하면 **지급 회수 카운터 0으로 초기화**
- 새 등급 기준 최대 회수 재적용

**예시:**

```
1월: F1 등급 → 1월 매출 → 10회 지급 (누적 10회)
2월: F1 등급 → 2월 매출 → 10회 지급 (누적 20회) ← F1 최대치
3월: F2 승급 → 카운터 0으로 리셋
3월: F2 등급 → 3월 매출 → 10회 지급 가능 (새로 누적 10회 시작)
```

### 5.3 F3 이상 보험 유지 조건

**필수 보험 최소 금액:**

| 등급   | 최소 보험금액 |
| ------ | ------------- |
| F3, F4 | 월 50,000원   |
| F5, F6 | 월 70,000원   |
| F7, F8 | 월 100,000원  |

**조건 미달 시:**

- 해당 월 매출의 **지급 대상에서 제외**
- 등급은 유지되지만 수익 지급만 중단

**보험 재가입 시:**

```
예시:
1월: F3, 보험 50,000원 유지 → 1월 매출 10회 지급 (누적 10회)
2월: F3, 보험 해지 → 2월 매출 지급 제외 (누적 10회 유지)
3월: F3, 보험 50,000원 재가입 → 3월 매출 10회 지급 (누적 20회로 계속)
```

**핵심:** 보험 해지 후 재가입해도 **기존 회수 유지** (리셋 안 됨)

---

## 6. 운영 프로세스

### 6.1 월간 운영 흐름

```
[매월 말일]
1. 신규 가입 마감
2. 월 총매출 집계 (신규 인원 × 100만원)
3. 등급별 인원 분포 확인
4. 등급별 개인 지급액 계산
5. 10주 분할 지급 스케줄 생성

[익월부터 10주간]
6. 매주 자동 지급 실행
7. 원천징수 3.3% 공제
8. 용역자별 입금 처리
```

### 6.2 자동 처리 항목

- ✅ 신규 등록 시 트리 구조 자동 배치
- ✅ 등급 자동 계산 및 갱신
- ✅ 월별 매출 자동 집계
- ✅ 지급액 자동 계산
- ✅ 주별 지급 스케줄 자동 생성
- ✅ 지급 회수 카운터 자동 증가
- ✅ 등급 변경 시 카운터 자동 리셋

### 6.3 관리자 수동 작업

#### 6.3.1 F3 이상 보험 유지 조건 설정

**기능:**

- 용역자 편집 화면에서 보험 유지 조건 설정
- F3 이상 등급 용역자에 대해 적용

**설정 항목:**

- 보험 유지 여부: 활성/비활성
- 보험 유지 금액: 금액 입력 (원 단위)

**관리 방법:**

```
용역자 편집 화면:
- 이름: 홍길동
- 등급: F3
- 보험 유지 여부: ☑ 활성
- 보험 금액: 50,000원
```

#### 6.3.2 등급별 지급금액 고정 설정

**기능:**

- 특정 월의 **등급별 지급금액을 미리 지정** 가능
- 자동 계산 무시하고 고정된 금액으로 지급

**설정 방법:**

```
예시: 2024년 9월 매출분 지급금액 고정

F1 등급: 50,000원 고정
F2 등급: 150,000원 고정
F3 등급: 350,000원 고정
F4 등급: 600,000원 고정
F5 등급: 1,000,000원 고정
F6 등급: 1,500,000원 고정
F7 등급: 2,000,000원 고정
F8 등급: 3,000,000원 고정
```

**적용 효과:**

```
9월 매출 자동 계산 결과:
- 총매출: 2,000만원
- F2 자동 계산 금액: 175,700원

관리자 고정 설정 적용:
- F2 고정 금액: 150,000원

실제 지급:
- 9월 매출에 대한 F2 지급액: 150,000원 (고정)
- 10월부터 10회 분할: 회차당 15,000원
- 등급 변동 무시 (9월 매출은 고정 금액 유지)
```

**주요 특징:**

- ✅ **등급별 일괄 설정** (F1~F8 각각)
- ✅ **월별로 설정 가능** (9월분, 10월분 등)
- ✅ 설정하지 않은 등급은 자동 계산 금액 사용
- ✅ 일부 등급만 선택 설정 가능
- ✅ 10회 분할 방식은 동일하게 적용
- ✅ 고정 설정 시 등급 변동에도 금액 불변

---

## 7. 시스템 규칙 종합 정리

### 7.1 매출 및 지급 프로세스 전체 흐름

```
[Step 1] 매월 말일
├─ 1일~말일 신규 가입자 집계
└─ 월 총매출 = 가입자 수 × 100만원

[Step 2] 익월 첫 금요일부터 10개 금요일
├─ 각 금요일마다:
│  ├─ 등급 기준일 계산: 금요일 -1개월 -1일
│  ├─ 해당 일자의 용역자 등급 확인
│  ├─ 전월 매출 기준 등급별 지급액 계산
│  ├─ 지급액 ÷ 10 = 회차 지급액
│  ├─ 원천징수 3.3% 공제
│  └─ 실지급
│
└─ 10회 완료 시 해당 매출 지급 종료
```

**종합 예시:**

```
[9월]
- 1~30일: 신규 가입 10명
- 총매출: 1,000만원
- 홍길동 등급 변화:
  · 9/1~9/6: F2
  · 9/7~9/30: F3

[10월 4일(금) 지급]
- 등급 기준: 9/3 → F2
- F2 지급액: 100만원
- 1회차: 10만원
- 원천징수: 3,300원
- 실지급: 96,700원

[10월 11일(금) 지급]
- 등급 기준: 9/10 → F3
- F3 지급액: 150만원
- 2회차: 15만원
- 원천징수: 4,950원
- 실지급: 145,050원
```

### 7.2 주요 변경사항 요약

| 항목            | 기존 방식              | 신규 방식                   |
| --------------- | ---------------------- | --------------------------- |
| **지급일**      | 주차별 (요일 불명)     | **매주 금요일**             |
| **매출 집계**   | createdAt 기준         | **매월 1일~말일**           |
| **등급 기준**   | 매출 발생 월 등급 고정 | **지급일 -1개월 -1일 등급** |
| **지급액 변동** | 10회 동일 금액         | **회차마다 다를 수 있음**   |
| **수동 설정**   | 없음                   | **관리자 금액 고정 가능**   |

### 7.3 유지되는 기존 규칙

- ✅ 이진트리 구조 및 L→R 배치
- ✅ F1~F8 등급 자동 계산
- ✅ 누적식 지급액 계산 (F1 24% 기준)
- ✅ 100원 단위 절삭
- ✅ 10회 분할 지급
- ✅ 원천징수 3.3%
- ✅ 중첩 지급 (여러 매출 동시 수령)
- ✅ 등급별 최대 지급 회수 제한
- ✅ 등급 상승 시 카운터 리셋
- ✅ F3 이상 보험 조건

### 7.4 ✅ 확인 필요 항목 체크리스트

- [ ] 수동 금액 입력 시 10회 동안 고정 유지 확인
- [ ] 같은 금요일에 중첩 지급 시 모두 동일 등급 기준일 사용 확인
- [ ] 전월에 해당 일자 없을 때 전월 말일 사용 확인
- [ ] 보험 금액 입력 방법: 관리자 입력? 연동?
- [ ] F1~F2 용역자는 보험 조건 없음 확인
- [ ] 등급별 최대 회수 도달 시 용역자 알림 필요 여부
- [ ] 보험 해지 시 용역자 알림 필요 여부

---

## 8. 주요 용어 정리

| 용어            | 설명                                         |
| --------------- | -------------------------------------------- |
| **용역자**      | MLM 조직 참여자                              |
| **판매인**      | 신규 용역자를 추천한 상위 용역자             |
| **이진트리**    | 각 노드가 최대 2개 자식을 갖는 트리 구조     |
| **등급**        | F1~F8, 조직 규모에 따라 자동 산정            |
| **누적식 배분** | 하위 등급 지급액을 상위 등급이 포함하여 수령 |
| **회차**        | 10회 분할 지급의 각 단위 (1회차~10회차)      |
| **지급 총회수** | 같은 등급 유지 중 받은 총 지급 횟수          |
| **카운터 리셋** | 등급 상승 시 지급 총회수를 0으로 초기화      |

---

## 9. 수정 및 추가 요구사항

### 9.1 수정 요구사항

```
(기존 내용 중 수정이 필요한 부분을 기재해 주세요)











```

### 9.2 추가 요구사항

```
(새로운 기능이나 규칙이 필요한 경우 기재해 주세요)











```

---

**문서 끝**

_본 문서는 개발 요구사항 확인을 위한 검토 문서입니다._
