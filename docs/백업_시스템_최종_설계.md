# ë‚˜ëˆ”í˜ì´ ë°±ì—… ì‹œìŠ¤í…œ ìµœì¢… ì„¤ê³„

**ì‘ì„±ì¼**: 2025-10-26  
**ë²„ì „**: v1.0 Final  
**ê¸°ìˆ  ìŠ¤íƒ**: Bun + JavaScript, MongoDB, Crontab

---

## ğŸ“‹ í•µì‹¬ êµ¬ì¡°

### ê°„ë‹¨ ìš”ì•½:

```
ì›¹ UI (ì„¤ì • ë³€ê²½)
    â†“ (DB ì €ì¥)
MongoDB (systemSettings.backup)
    â†“ (Crontab ì—…ë°ì´íŠ¸)
Crontab (ì‹œê°„ ìŠ¤ì¼€ì¤„ë§)
    â†“ (ì •í•´ì§„ ì‹œê°„ì— ì‹¤í–‰)
nanumpay-backup (Bun ì‹¤í–‰íŒŒì¼)
    â†“ (DBì—ì„œ ì„¤ì • ì½ê¸°)
MongoDB (ì„¤ì • ì¡°íšŒ)
    â†“ (ë°±ì—… ìˆ˜í–‰)
mongodump â†’ ì••ì¶• â†’ S3/FTP ì—…ë¡œë“œ â†’ ë³´ê´€ì •ì±…
```

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì„± ìš”ì†Œ

### 1. **ë°±ì—… ì‹¤í–‰ê¸°** (`nanumpay-backup`)

**ì—­í• **: ë°±ì—… ì‹¤ì œ ìˆ˜í–‰
**ê¸°ìˆ **: Bunìœ¼ë¡œ ì»´íŒŒì¼ëœ ë‹¨ì¼ ì‹¤í–‰íŒŒì¼ (~25MB)
**ìœ„ì¹˜**: `/opt/nanumpay/bin/nanumpay-backup`

**ë™ì‘**:
1. MongoDB ì—°ê²°
2. `db.admins.findOne().systemSettings.backup` ì„¤ì • ì½ê¸°
3. `enabled: false` â†’ ì¢…ë£Œ
4. `enabled: true` â†’ ë°±ì—… ìˆ˜í–‰:
   - mongodump ì‹¤í–‰
   - ì••ì¶• (ì„¤ì • ì‹œ)
   - S3/FTP ì—…ë¡œë“œ (ì„¤ì • ì‹œ)
   - ë³´ê´€ ì •ì±… ì ìš©
5. ë¡œê·¸ ê¸°ë¡

**íŠ¹ì§•**:
- âœ… DBì—ì„œ ì§ì ‘ ì„¤ì • ì½ìŒ (ì„¤ì • íŒŒì¼ ì—†ìŒ)
- âœ… MongoDB ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ ë¨ (ì •ìƒ - ë°±ì—… ëŒ€ìƒì´ ì—†ìœ¼ë¯€ë¡œ)
- âœ… ë‹¨ë… ì‹¤í–‰ ê°€ëŠ¥ (ìˆ˜ë™ ë°±ì—… ê°€ëŠ¥)

---

### 2. **Crontab ê´€ë¦¬**

**ì—­í• **: ë°±ì—… ì‹œê°„ ìŠ¤ì¼€ì¤„ë§
**ë°©ì‹**: ì›¹ APIì—ì„œ Crontab ì§ì ‘ ì—…ë°ì´íŠ¸

**Crontab ì˜ˆì‹œ**:
```bash
# nanumpay-backup
0 2 * * * /opt/nanumpay/bin/nanumpay-backup >> /logs/backup.log 2>&1
```

**ì„¤ì • ë³€ê²½ ì‹œ**:
```
ì›¹ UIì—ì„œ ì €ì¥ ë²„íŠ¼ í´ë¦­
    â†“
API: PUT /api/admin/settings/system
    â†“
1. MongoDB ì—…ë°ì´íŠ¸
2. Cron í‘œí˜„ì‹ ìƒì„±
3. crontab ì—…ë°ì´íŠ¸ (exec ëª…ë ¹)
    â†“
Crontab ë°˜ì˜ (ì¦‰ì‹œ)
```

---

### 3. **ì›¹ UI**

**ìœ„ì¹˜**: ê´€ë¦¬ì ì„¤ì • > ì‹œìŠ¤í…œ ì„¤ì • > ë°±ì—… ì„¤ì •

**ê¸°ëŠ¥**:
- âœ… ë°±ì—… í™œì„±í™”/ë¹„í™œì„±í™”
- âœ… ì£¼ê¸°: daily/weekly/monthly
- âœ… ì‹œê°„, ìš”ì¼, ì¼ì ì„¤ì •
- âœ… ë³´ê´€ ì •ì±… (ê°œìˆ˜/ê¸°ê°„/ì••ì¶•)
- âœ… ì €ì¥ì†Œ ì„¤ì • (S3/FTP)
- âœ… **ì¦‰ì‹œ ë°±ì—…** ë²„íŠ¼ (ìˆ˜ë™ ì‹¤í–‰)
- âœ… **ë°±ì—… ëª©ë¡ ì¡°íšŒ** (ì„ íƒ)

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
nanumpay/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                          # ê¸°ì¡´ ì›¹ ì•±
â”‚   â”‚   â””â”€â”€ src/routes/api/admin/
â”‚   â”‚       â””â”€â”€ settings/system/
â”‚   â”‚           â””â”€â”€ +server.js        # Crontab ì—…ë°ì´íŠ¸ í¬í•¨
â”‚   â”‚
â”‚   â””â”€â”€ backup/                       # ìƒˆë¡œìš´ ë°±ì—… ì•±
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.js              # ë©”ì¸ ì§„ì…ì 
â”‚       â”‚   â”œâ”€â”€ config.js             # DB ì„¤ì • ì½ê¸°
â”‚       â”‚   â”œâ”€â”€ backup.js             # mongodump ì‹¤í–‰
â”‚       â”‚   â”œâ”€â”€ compress.js           # tar.gz ì••ì¶•
â”‚       â”‚   â”œâ”€â”€ storage/
â”‚       â”‚   â”‚   â”œâ”€â”€ s3.js             # AWS S3 ì—…ë¡œë“œ
â”‚       â”‚   â”‚   â””â”€â”€ ftp.js            # FTP ì—…ë¡œë“œ
â”‚       â”‚   â””â”€â”€ retention.js          # ë³´ê´€ ì •ì±…
â”‚       â”œâ”€â”€ build.sh                  # Bun ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
â”‚       â””â”€â”€ build/
â”‚           â””â”€â”€ nanumpay-backup       # ë¹Œë“œëœ ì‹¤í–‰íŒŒì¼
â”‚
â””â”€â”€ apps/web/install/linux/
    â””â”€â”€ bin/
        â””â”€â”€ nanumpay-backup           # DEB íŒ¨í‚¤ì§€ì— í¬í•¨
```

---

## ğŸ’» ì½”ë“œ êµ¬ì¡°

### `apps/backup/package.json`
```json
{
  "name": "@nanumpay/backup",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "bun run src/index.js",
    "build": "bash build.sh",
    "test": "bun run src/index.js --test"
  },
  "dependencies": {
    "mongodb": "^6.10.0",
    "aws-sdk": "^2.1691.0",
    "archiver": "^7.0.0"
  }
}
```

### `apps/backup/src/index.js`
```javascript
import { getBackupConfig } from './config.js';
import { runMongoDump } from './backup.js';
import { compress } from './compress.js';
import { uploadToS3, uploadToFTP } from './storage/index.js';
import { applyRetention } from './retention.js';
import { execSync } from 'child_process';
import * as fs from 'fs';

async function main() {
  console.log('ğŸš€ Nanumpay Backup starting...');

  try {
    // 1. DBì—ì„œ ì„¤ì • ì½ê¸°
    const config = await getBackupConfig();

    if (!config.enabled) {
      console.log('â¸ï¸  Backup is disabled');
      return;
    }

    // 2. ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const backupDir = `/opt/nanumpay/data/backups/${timestamp}`;

    // 3. mongodump ì‹¤í–‰
    console.log('ğŸ“¦ Running mongodump...');
    await runMongoDump(backupDir);

    // 4. ì••ì¶• (ì„ íƒ)
    let finalPath = backupDir;
    if (config.retention.compress) {
      console.log('ğŸ—œï¸  Compressing...');
      finalPath = await compress(backupDir);
      // ì••ì¶• í›„ ì›ë³¸ ì‚­ì œ
      fs.rmSync(backupDir, { recursive: true, force: true });
    }

    // 5. ì—…ë¡œë“œ
    if (config.storage.type === 's3') {
      console.log('â˜ï¸  Uploading to S3...');
      await uploadToS3(finalPath, config.storage.s3);
    } else if (config.storage.type === 'ftp') {
      console.log('ğŸ“¤ Uploading to FTP...');
      await uploadToFTP(finalPath, config.storage.ftp);
    }

    // 6. ë³´ê´€ ì •ì±… ì ìš©
    console.log('ğŸ§¹ Applying retention policy...');
    await applyRetention(config.retention);

    console.log(`âœ… Backup completed: ${finalPath}`);

  } catch (error) {
    console.error('âŒ Backup failed:', error.message);
    process.exit(1);
  }
}

main();
```

### `apps/backup/src/config.js`
```javascript
import { MongoClient } from 'mongodb';

export async function getBackupConfig() {
  const uri = process.env.MONGO_URI || 'mongodb://localhost:27017';
  const client = await MongoClient.connect(uri, {
    serverSelectionTimeoutMS: 5000
  });

  try {
    const db = client.db('nanumpay');
    const admin = await db.collection('admins').findOne();

    if (!admin?.systemSettings?.backup) {
      throw new Error('Backup configuration not found in database');
    }

    return admin.systemSettings.backup;

  } finally {
    await client.close();
  }
}
```

### `apps/backup/src/backup.js`
```javascript
import { execSync } from 'child_process';

export async function runMongoDump(outputDir) {
  const uri = process.env.MONGO_URI || 'mongodb://localhost:27017';
  const db = process.env.DB_NAME || 'nanumpay';

  const cmd = `mongodump --uri="${uri}" --db="${db}" --out="${outputDir}"`;

  try {
    execSync(cmd, { stdio: 'inherit' });
  } catch (error) {
    throw new Error(`mongodump failed: ${error.message}`);
  }
}
```

### `apps/backup/build.sh`
```bash
#!/bin/bash
set -e

echo "ğŸ”¨ Building nanumpay-backup..."

# Bun ì„¤ì¹˜ í™•ì¸
if ! command -v bun &> /dev/null; then
    echo "âŒ Bun is not installed. Install from https://bun.sh"
    exit 1
fi

# ì˜ì¡´ì„± ì„¤ì¹˜
bun install

# ë¹Œë“œ (Linux x64 íƒ€ê²Ÿ)
bun build src/index.js \
  --compile \
  --outfile build/nanumpay-backup \
  --target bun-linux-x64 \
  --minify

echo "âœ… Build complete!"
ls -lh build/nanumpay-backup
```

---

## ğŸ”§ Crontab ê´€ë¦¬ (ì›¹ API)

### `apps/web/src/routes/api/admin/settings/system/+server.js`

```javascript
import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

async function updateCrontab(backup) {
  if (!backup.enabled) {
    // ë¹„í™œì„±í™” - crontabì—ì„œ ì œê±°
    await removeCrontab();
    return;
  }

  // Cron í‘œí˜„ì‹ ìƒì„±
  const [hour, minute] = backup.time.split(':');
  let cronExpr = '';

  switch (backup.frequency) {
    case 'daily':
      cronExpr = `${minute} ${hour} * * *`;
      break;
    case 'weekly':
      cronExpr = `${minute} ${hour} * * ${backup.dayOfWeek}`;
      break;
    case 'monthly':
      cronExpr = `${minute} ${hour} ${backup.dayOfMonth} * *`;
      break;
  }

  // ê¸°ì¡´ crontab ì½ê¸°
  let existingCrontab = '';
  try {
    const { stdout } = await execAsync('crontab -l 2>/dev/null || echo ""');
    existingCrontab = stdout;
  } catch {}

  // nanumpay-backup ë¼ì¸ ì œê±°
  const lines = existingCrontab
    .split('\n')
    .filter(line => line && !line.includes('nanumpay-backup'));

  // ìƒˆ ë¼ì¸ ì¶”ê°€
  lines.push('# nanumpay-backup');
  lines.push(`${cronExpr} /opt/nanumpay/bin/nanumpay-backup >> /logs/backup.log 2>&1`);

  // crontab ì—…ë°ì´íŠ¸
  const newCrontab = lines.join('\n') + '\n';
  await execAsync(`echo "${newCrontab}" | crontab -`);

  console.log(`âœ… Crontab updated: ${cronExpr}`);
}

async function removeCrontab() {
  try {
    const { stdout } = await execAsync('crontab -l 2>/dev/null || echo ""');
    const lines = stdout
      .split('\n')
      .filter(line => line && !line.includes('nanumpay-backup'));
    
    const newCrontab = lines.join('\n') + '\n';
    await execAsync(`echo "${newCrontab}" | crontab -`);
    
    console.log('âœ… Backup crontab removed');
  } catch {}
}

export async function PUT({ request, locals }) {
  // ... ê¶Œí•œ í™•ì¸ ...

  const { backup } = await request.json();

  // 1. DB ì €ì¥
  await Admin.findByIdAndUpdate(adminId, {
    'systemSettings.backup': backup
  });

  // 2. Crontab ì—…ë°ì´íŠ¸
  await updateCrontab(backup);

  return json({ success: true, message: 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.' });
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. **ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸**

```bash
# ë°±ì—… ì•± ì§ì ‘ ì‹¤í–‰
cd apps/backup
bun run src/index.js

# ë¹Œë“œ í…ŒìŠ¤íŠ¸
bun run build
./build/nanumpay-backup
```

**í™•ì¸ ì‚¬í•­**:
- âœ… MongoDB ì—°ê²° ì„±ê³µ
- âœ… ì„¤ì • ì½ê¸° ì„±ê³µ
- âœ… mongodump ì‹¤í–‰
- âœ… ë°±ì—… íŒŒì¼ ìƒì„± í™•ì¸

---

### 2. **DB ì„¤ì • í…ŒìŠ¤íŠ¸**

```bash
# MongoDBì—ì„œ ì„¤ì • í™•ì¸
mongosh nanumpay --eval "db.admins.findOne().systemSettings.backup"

# ì„¤ì • ë³€ê²½ í…ŒìŠ¤íŠ¸ (ì›¹ UI ì‚¬ìš©)
# 1. ê´€ë¦¬ì ë¡œê·¸ì¸
# 2. ì„¤ì • > ì‹œìŠ¤í…œ ì„¤ì • > ë°±ì—… ì„¤ì •
# 3. í™œì„±í™” ON
# 4. ì£¼ê¸°: daily, ì‹œê°„: 03:00
# 5. ì €ì¥

# Crontab í™•ì¸
crontab -l | grep nanumpay-backup
# ì¶œë ¥ ì˜ˆìƒ:
# # nanumpay-backup
# 0 3 * * * /opt/nanumpay/bin/nanumpay-backup >> /logs/backup.log 2>&1
```

---

### 3. **ì¦‰ì‹œ ë°±ì—… í…ŒìŠ¤íŠ¸ (ì›¹ UI)**

**API ì¶”ê°€ í•„ìš”**:
```javascript
// apps/web/src/routes/api/admin/backup/run-now/+server.js
import { exec } from 'child_process';

export async function POST({ locals }) {
  if (!locals.user?.isAdmin) {
    return json({ success: false }, { status: 403 });
  }

  // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
  exec('/opt/nanumpay/bin/nanumpay-backup >> /logs/backup.log 2>&1 &');

  return json({
    success: true,
    message: 'ë°±ì—…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.'
  });
}
```

**ì›¹ UIì— ë²„íŠ¼ ì¶”ê°€**:
```svelte
<!-- apps/web/src/routes/(admin)/admin/settings/+page.svelte -->
<button onclick={handleBackupNow}>ì¦‰ì‹œ ë°±ì—…</button>

<script>
async function handleBackupNow() {
  const response = await fetch('/api/admin/backup/run-now', {
    method: 'POST'
  });
  
  if (response.ok) {
    alert('ë°±ì—…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
}
</script>
```

---

### 4. **Crontab ìë™ ì‹¤í–‰ í…ŒìŠ¤íŠ¸**

```bash
# 1. í˜„ì¬ ì‹œê°„ í™•ì¸
date
# ì¶œë ¥: 2025-10-26 14:30:00

# 2. Crontabì— 1ë¶„ í›„ ì‹œê°„ ì„¤ì •
crontab -e
# ì¶”ê°€:
# 31 14 * * * /opt/nanumpay/bin/nanumpay-backup >> /logs/backup.log 2>&1

# 3. ë¡œê·¸ ëª¨ë‹ˆí„°ë§
tail -f /logs/backup.log

# 4. 1ë¶„ í›„ í™•ì¸
# ì¶œë ¥ ì˜ˆìƒ:
# ğŸš€ Nanumpay Backup starting...
# ğŸ“¦ Running mongodump...
# âœ… Backup completed: /opt/nanumpay/data/backups/2025-10-26T14-31-00
```

---

### 5. **S3 ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸**

```bash
# 1. S3 ì„¤ì • (ì›¹ UI)
# - Region: ap-northeast-2
# - Bucket: my-nanumpay-backups
# - Access Key ID: AKIA...
# - Secret Access Key: ***

# 2. ì¦‰ì‹œ ë°±ì—… ì‹¤í–‰
/opt/nanumpay/bin/nanumpay-backup

# 3. S3 í™•ì¸
aws s3 ls s3://my-nanumpay-backups/nanumpay-backup/
# ì¶œë ¥:
# 2025-10-26 14:31:00  12345678  2025-10-26T14-31-00.tar.gz
```

---

### 6. **FTP ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸**

```bash
# 1. FTP ì„¤ì • (ì›¹ UI)
# - Host: ftp.example.com
# - Port: 21
# - Username: backup
# - Password: ***
# - Path: /backup/nanumpay

# 2. ì¦‰ì‹œ ë°±ì—… ì‹¤í–‰
/opt/nanumpay/bin/nanumpay-backup

# 3. FTP í™•ì¸
lftp -u backup,*** ftp.example.com
lftp> ls /backup/nanumpay
# ì¶œë ¥:
# -rw-r--r--   1 backup  backup  12345678 Oct 26 14:31 2025-10-26T14-31-00.tar.gz
```

---

### 7. **ë³´ê´€ ì •ì±… í…ŒìŠ¤íŠ¸**

```bash
# 1. ì„¤ì •: ìµœê·¼ 3ê°œë§Œ ìœ ì§€
# 2. ë°±ì—… 5ë²ˆ ì‹¤í–‰
for i in {1..5}; do
  /opt/nanumpay/bin/nanumpay-backup
  sleep 2
done

# 3. ë°±ì—… ëª©ë¡ í™•ì¸
ls -lht /opt/nanumpay/data/backups/
# ì¶œë ¥: ìµœì‹  3ê°œë§Œ ë‚¨ì•„ìˆì–´ì•¼ í•¨
```

---

### 8. **ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸**

```bash
# MongoDB ì¤‘ì§€
sudo systemctl stop mongod

# ë°±ì—… ì‹¤í–‰
/opt/nanumpay/bin/nanumpay-backup
# ì¶œë ¥ ì˜ˆìƒ:
# ğŸš€ Nanumpay Backup starting...
# âŒ Backup failed: MongoServerSelectionError: connect ECONNREFUSED

# ì¢…ë£Œ ì½”ë“œ í™•ì¸
echo $?
# ì¶œë ¥: 1 (ì‹¤íŒ¨)

# MongoDB ì¬ì‹œì‘
sudo systemctl start mongod
```

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ë³¸ ê¸°ëŠ¥
- [ ] DBì—ì„œ ì„¤ì • ì½ê¸° ì„±ê³µ
- [ ] `enabled: false` ì‹œ ì¦‰ì‹œ ì¢…ë£Œ
- [ ] mongodump ì‹¤í–‰ ì„±ê³µ
- [ ] ë°±ì—… íŒŒì¼ ìƒì„± í™•ì¸
- [ ] ì••ì¶• ì„±ê³µ (ì„¤ì • ì‹œ)
- [ ] ë¡œê·¸ ê¸°ë¡ í™•ì¸

### Crontab
- [ ] ì›¹ UIì—ì„œ ì„¤ì • ë³€ê²½ ì‹œ crontab ì—…ë°ì´íŠ¸
- [ ] daily/weekly/monthly ëª¨ë‘ í…ŒìŠ¤íŠ¸
- [ ] ë¹„í™œì„±í™” ì‹œ crontabì—ì„œ ì œê±°
- [ ] ì„¤ì • ì‹œê°„ì— ìë™ ì‹¤í–‰

### ì—…ë¡œë“œ
- [ ] S3 ì—…ë¡œë“œ ì„±ê³µ
- [ ] FTP ì—…ë¡œë“œ ì„±ê³µ
- [ ] ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œì—ë„ ë¡œì»¬ ë°±ì—… ìœ ì§€

### ë³´ê´€ ì •ì±…
- [ ] ê°œìˆ˜ ê¸°ì¤€ ì •ë¦¬ ë™ì‘
- [ ] ê¸°ê°„ ê¸°ì¤€ ì •ë¦¬ ë™ì‘
- [ ] ì••ì¶• íŒŒì¼ë§Œ ë‚¨ê¹€

### ì—ëŸ¬ ì²˜ë¦¬
- [ ] MongoDB ì—°ê²° ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] mongodump ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] ë””ìŠ¤í¬ ìš©ëŸ‰ ë¶€ì¡± ì‹œ ì²˜ë¦¬
- [ ] FTP/S3 ì—°ê²° ì‹¤íŒ¨ ì‹œì—ë„ ë¡œì»¬ ë°±ì—… ìœ ì§€

---

## ğŸš€ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### 1. ë¹Œë“œ
```bash
cd apps/backup
bun run build
```

### 2. DEB íŒ¨í‚¤ì§€ì— í¬í•¨
```bash
cp apps/backup/build/nanumpay-backup apps/web/install/linux/bin/
```

### 3. postinst ìˆ˜ì •
```bash
# apps/web/install/linux/postinst

# ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p /opt/nanumpay/data/backups
chown nanumpay:nanumpay /opt/nanumpay/data/backups

# ì‹¤í–‰ ê¶Œí•œ
chmod +x /opt/nanumpay/bin/nanumpay-backup

echo "Backup system installed. Configure via Admin Settings."
```

### 4. prerm ìˆ˜ì •
```bash
# apps/web/install/linux/prerm

# Crontab ì •ë¦¬
crontab -l 2>/dev/null | grep -v "nanumpay-backup" | crontab - || true
echo "Backup crontab removed"
```

---

## ğŸ“ ìš´ì˜ ê°€ì´ë“œ

### ìˆ˜ë™ ë°±ì—… ì‹¤í–‰
```bash
sudo -u nanumpay /opt/nanumpay/bin/nanumpay-backup
```

### ë¡œê·¸ í™•ì¸
```bash
tail -f /logs/backup.log
```

### Crontab í™•ì¸
```bash
crontab -l
```

### ë°±ì—… ëª©ë¡ í™•ì¸
```bash
ls -lht /opt/nanumpay/data/backups/
```

### ë°±ì—… ë³µì›
```bash
# ì••ì¶• í•´ì œ
tar -xzf /opt/nanumpay/data/backups/2025-10-26T14-31-00.tar.gz

# mongorestore
mongorestore --uri="mongodb://localhost:27017" --db="nanumpay" --drop ./nanumpay
```

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ
- [ ] Bun í”„ë¡œì íŠ¸ ìƒì„± (`apps/backup/`)
- [ ] `config.js` - DB ì„¤ì • ì½ê¸°
- [ ] `backup.js` - mongodump ì‹¤í–‰
- [ ] `compress.js` - tar.gz ì••ì¶•
- [ ] `storage/s3.js` - S3 ì—…ë¡œë“œ
- [ ] `storage/ftp.js` - FTP ì—…ë¡œë“œ
- [ ] `retention.js` - ë³´ê´€ ì •ì±…
- [ ] `index.js` - ë©”ì¸ ë¡œì§

### ì›¹ í†µí•©
- [ ] API: Crontab ì—…ë°ì´íŠ¸ ê¸°ëŠ¥
- [ ] API: ì¦‰ì‹œ ë°±ì—… ì‹¤í–‰
- [ ] UI: ì¦‰ì‹œ ë°±ì—… ë²„íŠ¼
- [ ] UI: ë°±ì—… ëª©ë¡ ì¡°íšŒ (ì„ íƒ)

### ë¹Œë“œ & ë°°í¬
- [ ] `build.sh` ì‘ì„±
- [ ] Linux ë¹Œë“œ í…ŒìŠ¤íŠ¸
- [ ] DEB íŒ¨í‚¤ì§€ í†µí•©
- [ ] postinst/prerm ìˆ˜ì •

### í…ŒìŠ¤íŠ¸
- [ ] ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸
- [ ] Crontab ìë™ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- [ ] S3 ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] FTP ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ë³´ê´€ ì •ì±… í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

---

**ë‹¤ìŒ ë‹¨ê³„**: ë‹¨ê³„ë³„ êµ¬í˜„ ì‹œì‘!
