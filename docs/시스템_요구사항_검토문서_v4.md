# MLM 시스템 요구사항 검토 문서

**버전**: 4.0 ⚠️ 중요 업데이트
**작성일**: 2025년 10월 11일
**목적**: 개발 요구사항 확인 및 검토

**주요 변경사항 (v4.0):**
- **지급 계획 생성 방식 변경**: 등록/승급 시 10회만 생성 (기존: 전체 횟수 사전 생성)
- **추가 지급 계획 자동 생성**: 10회 완료 시점에 완료된 매출월 기준으로 추가 10회 생성
- **동적 지급 계획**: 금요일 자동처리 시 추가 지급 계획 생성 로직 추가

---

## 📋 목차

1. [시스템 개요](#1-시스템-개요)
2. [조직 구조 및 등급 시스템](#2-조직-구조-및-등급-시스템)
3. [등록 프로세스](#3-등록-프로세스)
4. [매출 및 수익 배분](#4-매출-및-수익-배분)
5. [지급 규칙 (v4.0 변경)](#5-지급-규칙-v40-변경)
6. [운영 프로세스](#6-운영-프로세스)

---

## 1. 시스템 개요

### 1.1 시스템 목적

MLM(Multi-Level Marketing) 구조 기반 용역자 관리 및 수익 자동 배분 시스템

### 1.2 핵심 기능

- ✅ 이진트리(Binary Tree) 구조로 조직 관리
- ✅ 조직 규모에 따른 8단계 자동 등급 산정 (F1~F8)
- ✅ 매월 신규 가입 인원 기반 매출 계산
- ✅ 등급별 차등 수익 배분 (누적 방식)
- ✅ **10회 단위 분할 지급** (주 단위)
- ✅ **동적 지급 계획 생성** (10회 완료 시점에 추가 생성)

### 1.3 사용자 유형

- **관리자**: 시스템 전체 관리, 용역자 등록/조회, 매출 계산
- **용역자**: 개인 정보 조회, 수익 내역 확인

---

## 2. 조직 구조 및 등급 시스템

### 2.1 이진트리 구조

**기본 원칙:**

- 각 용역자는 최대 2명의 직속 하위자(좌/우)를 보유
- 신규 등록 시 좌측 우선 배치 (L → R)

### 2.2 등급 산정 규칙

| 등급   | 조건                                                                     | 최대 수령 횟수 |
| ------ | ------------------------------------------------------------------------ | -------------- |
| **F1** | 하위자 0~1명                                                             | 20회           |
| **F2** | 좌우 하위자 각 1명씩 보유                                                | 30회           |
| **F3** | 좌우 각각 F2 등급 1명 이상 보유                                          | 40회           |
| **F4** | 좌우 각각 F3 등급 1명 이상 보유                                          | 40회           |
| **F5** | 전체 조직에 F4 등급 총 3명 이상 보유 (좌우 최소 1:2 또는 2:1 이상)      | 50회           |
| **F6** | 전체 조직에 F5 등급 총 3명 이상 보유 (좌우 최소 1:2 또는 2:1 이상)      | 50회           |
| **F7** | 전체 조직에 F6 등급 총 3명 이상 보유 (좌우 최소 1:2 또는 2:1 이상)      | 60회           |
| **F8** | 전체 조직에 F7 등급 총 3명 이상 보유 (좌우 최소 1:2 또는 2:1 이상)      | 60회           |

**등급 계산 방식:**

- 시스템이 자동으로 계산 (실시간)
- 하위 조직 변화 시 상위 조직 등급도 자동 재계산
- 등급 변동에 따른 지급은 익월 지급부터 적용

---

## 3. 등록 프로세스

### 3.1 용역자 등록 방식

용역자는 **2가지 방식**으로 등록 가능합니다:

1. **엑셀 일괄 등록**: 여러 명을 한 번에 등록
2. **개별 등록**: 1명씩 직접 입력

**공통 필수 항목:**

- 성명, 연락처, 은행, 계좌번호
- 판매인(추천인), 가입일자, 설계사 정보

**자동 처리 항목:**

- 등급 자동 산정 (트리 구조 기반)
- 좌우 배치 위치 자동 결정
- 매출 자동 반영

### 3.2 등록 시 처리 흐름

```
[1] 사용자 정보 DB 저장
    ↓
[2] 트리 구조 재계산 (영향받는 사용자만)
    ↓
[3] 등급 자동 계산 (재계산된 사용자)
    ↓
[4] 월별 등록 정보 업데이트 (최신 등급으로)
    ↓
[5] 월별 트리 스냅샷 업데이트
    ↓
[6] **초기 10회 지급 계획 생성** ⭐ v4.0 변경
    - 등록월 매출 기준
    - 등록일+1개월 후 첫 금요일부터 시작
    - 10회 분할 지급
    ↓
[7] 승급자 처리 (있는 경우)
    - 승급 시점 매출 기준
    - 10회 분할 지급 계획 추가
```

---

## 4. 매출 및 수익 배분

### 4.1 매출 계산

- **월별 매출**: 해당 월 신규 등록 인원 × 1,000,000원
- **매출 귀속**: 등록일자 기준 월

**예시:**

- 2025년 7월 등록자 3명 → 2025-07 매출: 3,000,000원

### 4.2 등급별 배분 비율 (누적 방식)

| 등급 | 매출 대비 비율 | 3백만원 기준 금액 |
| ---- | -------------- | ----------------- |
| F1   | 8%             | 240,000원         |
| F2   | +19%           | 810,000원         |
| F3   | +15%           | 1,260,000원       |
| F4   | +13%           | 1,650,000원       |
| F5   | +12%           | 2,010,000원       |
| F6   | +11%           | 2,340,000원       |
| F7   | +10%           | 2,640,000원       |
| F8   | +9%            | 2,910,000원       |

**누적 방식 설명:**

- F2는 F1 금액(8%) + F2 추가 금액(19%) = 27%를 받습니다
- F3는 F1+F2+F3 = 42%를 받습니다

---

## 5. 지급 규칙 (v4.0 변경)

### 5.1 기본 지급 원칙 ⭐ 중요 변경

#### 5.1.1 초기 지급 계획 (등록/승급 시)

**생성 시점:**
- 용역자 등록 시
- 등급 승급 시

**생성 내용:**
- **10회 분할 지급 계획만 생성** (기존: 최대 횟수 전부 생성)
- 등록월/승급월의 매출 기준으로 금액 계산
- 등록일(승급일) + 1개월 후 첫 금요일부터 시작

**예시: F1 등급 용역자 등록**
```
등록일: 2025-07-01
등록월 매출: 3,000,000원
F1 지급액: 240,000원 ÷ 10 = 24,000원/회

생성되는 지급 계획:
- 1회차: 2025-08-01 (금) - 24,000원
- 2회차: 2025-08-08 (금) - 24,000원
- ...
- 10회차: 2025-10-03 (금) - 24,000원
```

#### 5.1.2 추가 지급 계획 (10회 완료 시) ⭐ 신규 기능

**생성 시점:**
- **매주 금요일 자동 처리 시**
- 10회차 지급이 완료되는 시점에 자동 실행

**생성 조건:**
1. 이전 10회 지급이 모두 완료됨
2. 현재 등급이 최대 수령 횟수 미만
3. 등급 유지 확인:
   - **F1, F2**: 등급만 확인
   - **F3 이상**: 등급 + 보험 가입 유지 확인

**생성 내용:**
- **추가 10회 분할 지급 계획 생성**
- **10회차 완료된 매출월**의 매출 기준으로 금액 계산
- 다음 금요일부터 시작

**예시 1: F1 등급 - 10회 완료 후 추가 지급**
```
초기 10회 (2025-07월 매출 기준):
- 1~10회차: 2025-08-01 ~ 2025-10-03
- 10회차 완료: 2025-10-03 (금)

10회차 완료 시점 확인:
- 현재 회차: 10회 (완료)
- 최대 횟수: 20회 (F1)
- 등급 유지: F1 (OK)
- 완료 매출월: 2025-10월

추가 10회 생성 (2025-10월 매출 기준):
- 11회차: 2025-10-10 (금) - 2025-10 매출로 계산
- 12회차: 2025-10-17 (금)
- ...
- 20회차: 2025-12-05 (금)

20회 완료 후:
- F1 최대 횟수 도달 → 추가 생성 안 함
```

**예시 2: F2 승급 → 추가 지급 발생**
```
초기 상태: F1 등급
- 1~10회차: 2025-08-01 ~ 2025-10-03 (F1 금액)
- 10회차 완료: 2025-10-03

10회차 완료 시점:
- 등급: F2로 승급됨! ⭐
- 완료 매출월: 2025-10월

처리:
1. F1 계획의 11~20회차 생성 (F1 금액, 2025-10 매출 기준)
2. F2 승급에 따른 별도 10회 계획 생성 (F2 금액, 2025-10 매출 기준)

결과: 병행 지급
- F1 계획: 11~20회차 진행
- F2 계획: 1~10회차 진행 (동시)
```

**예시 3: F3 등급 - 보험 조건 추가**
```
F3 등급 20회 완료 시점:
- 현재 회차: 20회
- 최대 횟수: 40회 (F3)
- 등급 유지: F3 (OK)
- 보험 가입: 유지 중 (OK) ⭐
- 완료 매출월: 2025-12월

조건 만족 → 추가 10회 생성:
- 21~30회차: 2025-12 매출 기준
```

### 5.2 등급별 지급 제한

| 등급         | 최대 수령 횟수 | 추가 조건      | 생성 방식        |
| ------------ | -------------- | -------------- | ---------------- |
| **F1**       | 20회           | 등급 유지      | 10회씩 2번 생성  |
| **F2**       | 30회           | 등급 유지      | 10회씩 3번 생성  |
| **F3**       | 40회           | 등급+보험 유지 | 10회씩 4번 생성  |
| **F4**       | 40회           | 등급+보험 유지 | 10회씩 4번 생성  |
| **F5**       | 50회           | 등급+보험 유지 | 10회씩 5번 생성  |
| **F6**       | 50회           | 등급+보험 유지 | 10회씩 5번 생성  |
| **F7**       | 60회           | 등급+보험 유지 | 10회씩 6번 생성  |
| **F8**       | 60회           | 등급+보험 유지 | 10회씩 6번 생성  |

### 5.3 승급 시 지급 규칙

**기존 지급 계속 진행:**
- 승급 전 등급의 지급 계획은 **중단하지 않음**
- 기존 계획과 신규 계획 **병행 지급**

**신규 지급 계획 생성:**
- 승급 시점에 **10회 지급 계획 생성**
- 승급 시점의 매출월 기준으로 금액 계산

**예시: F1 → F2 승급 (10회차 완료 시점)**
```
2025-10-03 (10회차 완료 시점):
- F1 등급 10회 완료
- F2로 승급 확인

생성되는 계획:
1. F1 추가 계획 (11~20회): 2025-10 매출 기준, F1 금액
2. F2 초기 계획 (1~10회): 2025-10 매출 기준, F2 금액

2025-10-10 (금) 지급:
- F1 11회차: 24,000원
- F2 1회차: 81,000원
- 합계: 105,000원 (병행 지급)
```

### 5.4 지급 중단 조건

**추가 지급 생성 중단:**
- 등급이 하락한 경우
- F3 이상이 보험 미가입/미유지인 경우
- 최대 수령 횟수 도달

**기존 지급 계속:**
- 조건 미충족 시 **기존 진행 중인 계획은 계속 지급**
- 추가 10회만 생성되지 않음

---

## 6. 운영 프로세스

### 6.1 금요일 자동 처리 프로세스 ⭐ v4.0 변경

**매주 금요일 자동 실행:**

```
[1] 해당 주차 지급 대상 조회
    ↓
[2] 지급 처리 (status: pending → paid)
    ↓
[3] 10회 완료 확인 ⭐ 신규 추가
    - 각 지급 계획의 완료 회차 확인
    - 10의 배수 회차 완료 시 추가 처리
    ↓
[4] 추가 지급 계획 생성 조건 확인 ⭐ 신규 추가
    - 최대 수령 횟수 확인
    - 등급 유지 확인
    - F3 이상: 보험 유지 확인
    ↓
[5] 조건 만족 시 추가 10회 계획 생성 ⭐ 신규 추가
    - 완료된 매출월 기준으로 금액 계산
    - 다음 금요일부터 시작하는 10회 계획
    ↓
[6] 승급자 확인 및 처리
    - 승급 시 별도 10회 계획 생성
    ↓
[7] 통계 업데이트
```

### 6.2 월말 처리

- 월별 트리 스냅샷 생성
- 등급 분포 확정
- 매출 확정

---

## 7. 주요 변경사항 요약 (v3.0 → v4.0)

| 항목                 | v3.0 (이전)                      | v4.0 (변경)                            |
| -------------------- | -------------------------------- | -------------------------------------- |
| **지급 계획 생성**   | 등록 시 전체 횟수 사전 생성      | 등록 시 10회만 생성                    |
| **추가 계획 생성**   | 사전 생성 (미래 예측)            | 10회 완료 시점에 동적 생성             |
| **매출 기준**        | 등록월 매출로 전체 계획          | 각 10회 완료 시점의 매출월 기준        |
| **금요일 자동처리**  | 지급 처리만                      | 지급 + 10회 완료 확인 + 추가 계획 생성 |
| **조건 확인 시점**   | 등록 시 1회                      | 10회 완료 시점마다 확인                |
| **F3 보험 확인**     | 등록 시                          | 매 10회 완료 시점                      |

---

## 8. 개발 시 주의사항

### 8.1 데이터 일관성

- 10회 완료 시점을 정확히 감지
- 매출월 계산 정확성 (완료 시점의 매출월)
- 병행 지급 시 중복 확인

### 8.2 성능 고려

- 금요일 자동처리 시 대량 데이터 처리
- 조건 확인 쿼리 최적화
- 트랜잭션 처리

### 8.3 예외 처리

- 매출이 없는 월 처리
- 등급 변동 중 지급 계획 처리
- 보험 상태 변경 처리

---

**문서 버전 히스토리:**

- v4.0 (2025-10-11): 동적 지급 계획 생성 방식으로 변경
- v3.0 (2025-10-11): 병행 지급 및 추가 지급기간 도입
- v2.0 (2025-09-20): 등급별 최대 수령 횟수 추가
- v1.0 (2025-09-01): 초기 버전
