# MLM ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ v6.0

**ë²„ì „**: 6.0
**ì‘ì„±ì¼**: 2025ë…„ 10ì›” 11ì¼
**ê¸°ì¤€ ìš”êµ¬ì‚¬í•­**: ì‹œìŠ¤í…œ_ìš”êµ¬ì‚¬í•­_ê²€í† ë¬¸ì„œ v4.0

**ì£¼ìš” ë³€ê²½ì‚¬í•­ (v6.0)**:
- **ë™ì  ì§€ê¸‰ ê³„íš ìƒì„±**: ë“±ë¡/ìŠ¹ê¸‰ ì‹œ 10íšŒë§Œ ìƒì„±
- **10íšŒ ì™„ë£Œ ì‹œì  ì²˜ë¦¬**: ê¸ˆìš”ì¼ ìë™ì²˜ë¦¬ì—ì„œ ì¶”ê°€ ê³„íš ìƒì„±
- **ë§¤ì¶œì›” ê¸°ì¤€ ë³€ê²½**: ê° 10íšŒ ì™„ë£Œ ì‹œì ì˜ ë§¤ì¶œì›” ê¸°ì¤€
- **ì¡°ê±´ í™•ì¸ ì£¼ê¸°**: ë§¤ 10íšŒ ì™„ë£Œ ì‹œì ë§ˆë‹¤ ë“±ê¸‰/ë³´í—˜ í™•ì¸

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#2-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
3. [ì§€ê¸‰ ê³„íš ì²˜ë¦¬ ë°©ì•ˆ](#3-ì§€ê¸‰-ê³„íš-ì²˜ë¦¬-ë°©ì•ˆ)
4. [ìë™í™” í”„ë¡œì„¸ìŠ¤](#4-ìë™í™”-í”„ë¡œì„¸ìŠ¤)
5. [ì›¹ API ì„¤ê³„](#5-ì›¹-api-ì„¤ê³„)
6. [ë°ì´í„° íë¦„ë„](#6-ë°ì´í„°-íë¦„ë„)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 í•µì‹¬ ì›ì¹™

**v4.0 ìš”êµ¬ì‚¬í•­ ê¸°ë°˜ ì„¤ê³„ ì›ì¹™**:

1. **ë³‘í–‰ ì§€ê¸‰**: ìŠ¹ê¸‰ ì‹œ ê¸°ì¡´ ì§€ê¸‰ ì¤‘ë‹¨í•˜ì§€ ì•Šê³  ìƒˆ ì§€ê¸‰ ì¶”ê°€
2. **ë™ì  ê³„íš ìƒì„±**: 10íšŒ ì™„ë£Œ ì‹œì ì— ì¶”ê°€ 10íšŒ ê³„íš ìƒì„± â­ ì‹ ê·œ
3. **ë§¤ì¶œì›” ê¸°ì¤€**: ê° 10íšŒ ì™„ë£Œ ì‹œì ì˜ ë§¤ì¶œì›”ë¡œ ê¸ˆì•¡ ì¬ê³„ì‚° â­ ì‹ ê·œ
4. **ì¡°ê±´ í™•ì¸**: ë§¤ 10íšŒ ì™„ë£Œ ì‹œì ë§ˆë‹¤ ë“±ê¸‰/ë³´í—˜ í™•ì¸ â­ ì‹ ê·œ
5. **ì£¼ê°„ ì§‘ê³„**: ê¸ˆìš”ì¼ë§ˆë‹¤ ìë™ ì§€ê¸‰ + ì¶”ê°€ ê³„íš ìƒì„±

### 1.2 ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
[ìš©ì—­ì ë“±ë¡]
    â†“
[íŠ¸ë¦¬/ë“±ê¸‰ ì¬ê³„ì‚°] â† ì˜í–¥ë°›ëŠ” ì‚¬ìš©ìë§Œ
    â†“
[ì´ˆê¸° 10íšŒ ì§€ê¸‰ê³„íš ìƒì„±] â­ v6.0: 10íšŒë§Œ
    â†“
[ì£¼ì°¨ë³„ ì´ê³„ ì—…ë°ì´íŠ¸]
    â†“
[ë§¤ì£¼ ê¸ˆìš”ì¼ ìë™ ì§€ê¸‰]
    â†“
[10íšŒ ì™„ë£Œ í™•ì¸] â­ v6.0 ì‹ ê·œ
    â†“
[ì¶”ê°€ 10íšŒ ê³„íš ìƒì„±] â­ v6.0 ì‹ ê·œ
    â†“
[í†µê³„ ì¦ë¶„ ì—…ë°ì´íŠ¸]
```

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 2.1 ì»¬ë ‰ì…˜ ê°œìš”

ì „ì²´ **4ê°œ í•µì‹¬ ì»¬ë ‰ì…˜** êµ¬ì„±:

| ì»¬ë ‰ì…˜ëª… | ëª©ì  | ì—…ë°ì´íŠ¸ ì‹œì  | ì¡°íšŒ ë¹ˆë„ |
|---------|------|--------------|----------|
| **monthlyRegistrations** | ì›”ë³„ ë“±ë¡/ë§¤ì¶œ ê´€ë¦¬ | ìš©ì—­ì ë“±ë¡ ì‹œ | ë‚®ìŒ |
| **monthlyTreeSnapshots** | ì›”ë³„ ê³„ì¸µë„/ë“±ê¸‰ í™•ì • | ë“±ë¡ ì‹œ + ì›”ë§ | ì¤‘ê°„ |
| **weeklyPaymentPlans** | ê°œë³„ ì§€ê¸‰ ê³„íš | ë“±ë¡/ìŠ¹ê¸‰/10íšŒì™„ë£Œ ì‹œ â­ | ë†’ìŒ |
| **weeklyPaymentSummary** | ì£¼ì°¨ë³„ ì´ê³„ (í†µê³„) | ë“±ë¡/ì§€ê¸‰/10íšŒì™„ë£Œ ì‹œ â­ | ë§¤ìš° ë†’ìŒ |

---

### 2.2 ì»¬ë ‰ì…˜ ìƒì„¸ ì„¤ê³„

#### 2.2.1 monthlyRegistrations (ì›”ë³„ ë“±ë¡ ê´€ë¦¬)

**ëª©ì **: ë§¤ì›” ìš©ì—­ì ë“±ë¡ ë° ë§¤ì¶œ ê´€ë¦¬

```javascript
{
  _id: ObjectId,
  monthKey: String,              // "2025-10" (YYYY-MM)

  // ë“±ë¡ ì •ë³´
  registrationCount: Number,     // í•´ë‹¹ ì›” ë“±ë¡ ì¸ì›
  totalRevenue: Number,          // ì´ë§¤ì¶œ (ì¸ì› Ã— 100ë§Œì›)
  adjustedRevenue: Number,       // ê´€ë¦¬ì ìˆ˜ë™ ì¡°ì • ê¸ˆì•¡ (nullì´ë©´ ìë™)

  // ë“±ë¡ì ëª©ë¡
  registrations: [{
    userId: String,
    userName: String,
    registrationDate: Date,      // ì‹¤ì œ ë“±ë¡ì¼
    sponsorId: String,           // í›„ì›ì
    grade: String,               // ë“±ë¡ ì‹œì  ë“±ê¸‰ (ë“±ê¸‰ ì¬ê³„ì‚° í›„)
    position: String             // 'left' | 'right' | 'root'
  }],

  // ë“±ê¸‰ë³„ ë¶„í¬ (ì›”ë§ ê¸°ì¤€)
  gradeDistribution: {
    F1: Number,
    F2: Number,
    F3: Number,
    F4: Number,
    F5: Number,
    F6: Number,
    F7: Number,
    F8: Number
  },

  // ë“±ê¸‰ë³„ ë°°ë¶„ ê¸ˆì•¡ (ëˆ„ì  ë°©ì‹)
  gradePayments: {
    F1: Number,  // 8%
    F2: Number,  // 27%
    F3: Number,  // 42%
    F4: Number,  // 55%
    F5: Number,  // 67%
    F6: Number,  // 78%
    F7: Number,  // 88%
    F8: Number   // 97%
  },

  createdAt: Date,
  updatedAt: Date
}
```

**ì¸ë±ìŠ¤:**
- `monthKey` (unique)
- `registrations.userId`

**ì—…ë°ì´íŠ¸ ì‹œì :**
- ìš©ì—­ì ë“±ë¡ ì‹œ (ë“±ê¸‰ ì¬ê³„ì‚° í›„)

---

#### 2.2.2 weeklyPaymentPlans (ê°œë³„ ì§€ê¸‰ ê³„íš) â­ v6.0 ë³€ê²½

**ëª©ì **: ìš©ì—­ìë³„ 10íšŒ ë‹¨ìœ„ ì§€ê¸‰ ê³„íš ê´€ë¦¬

```javascript
{
  _id: ObjectId,
  userId: String,
  userName: String,

  // ê³„íš ìœ í˜• â­ v6.0: generation ì¶”ê°€
  planType: String,              // 'initial' | 'promotion' | 'additional'
  generation: Number,            // ëª‡ ë²ˆì§¸ 10íšŒì¸ì§€ (1, 2, 3, ...) â­ ì‹ ê·œ

  // ê¸°ì¤€ ì •ë³´
  baseGrade: String,             // ê³„íš ìƒì„± ì‹œì  ë“±ê¸‰
  revenueMonth: String,          // ë§¤ì¶œ ê·€ì† ì›” (YYYY-MM)
  startDate: Date,               // ì§€ê¸‰ ì‹œì‘ì¼ (ì²« ê¸ˆìš”ì¼)

  // ì§„í–‰ ì •ë³´
  totalInstallments: Number,     // ì´ í• ë¶€ íšŸìˆ˜ (í•­ìƒ 10) â­ v6.0: 10 ê³ ì •
  completedInstallments: Number, // ì™„ë£Œëœ íšŸìˆ˜
  planStatus: String,            // 'active' | 'completed' | 'terminated'

  // í• ë¶€ ìƒì„¸ (10ê°œ) â­ v6.0: í•­ìƒ 10ê°œ
  installments: [{
    week: Number,                // íšŒì°¨ (1~10)
    weekNumber: String,          // ISO ì£¼ì°¨ (2025-W31)
    scheduledDate: Date,         // ì§€ê¸‰ ì˜ˆì •ì¼ (ê¸ˆìš”ì¼)

    revenueMonth: String,        // ë§¤ì¶œ ê·€ì† ì›”
    gradeAtPayment: String,      // ì‹¤ì œ ì§€ê¸‰ ì‹œì  ë“±ê¸‰ (ì§€ê¸‰ ì‹œ ê¸°ë¡)

    baseAmount: Number,          // ê¸°ì¤€ ê¸ˆì•¡ (ë“±ê¸‰ë³„ ë°°ë¶„ì•¡)
    installmentAmount: Number,   // íšŒì°¨ ì§€ê¸‰ì•¡ (ê¸°ì¤€Ã·10)
    withholdingTax: Number,      // ì›ì²œì§•ìˆ˜ì„¸ (3.3%)
    netAmount: Number,           // ì‹¤ìˆ˜ë ¹ì•¡

    status: String,              // 'pending' | 'paid' | 'skipped'
    paidDate: Date,              // ì‹¤ì œ ì§€ê¸‰ì¼
    insuranceSkipped: Boolean,   // ë³´í—˜ ë¯¸ê°€ì…ìœ¼ë¡œ ê±´ë„ˆëœ€

    installmentType: String      // 'initial' | 'additional' (í•­ìƒ initial) â­
  }],

  // ì¶”ê°€ ì •ë³´ â­ v6.0 ì‹ ê·œ
  parentPlanId: ObjectId,        // ì´ì „ 10íšŒ ê³„íš ID (ì—°ê²° ì¶”ì ìš©)
  createdBy: String,             // 'registration' | 'promotion' | 'auto_generation'

  createdAt: Date,
  updatedAt: Date
}
```

**v6.0 ì£¼ìš” ë³€ê²½:**
- `generation`: ëª‡ ë²ˆì§¸ 10íšŒì¸ì§€ ì¶”ì  (1, 2, 3, ...)
- `totalInstallments`: í•­ìƒ 10ìœ¼ë¡œ ê³ ì •
- `parentPlanId`: ì´ì „ ê³„íšê³¼ì˜ ì—°ê²° ê´€ê³„
- `createdBy`: ìƒì„± ì¶œì²˜ êµ¬ë¶„

**ì¸ë±ìŠ¤:**
- `userId`
- `planType`
- `generation`
- `baseGrade`
- `revenueMonth`
- `planStatus`
- `installments.weekNumber`
- `installments.status`

---

#### 2.2.3 weeklyPaymentSummary (ì£¼ì°¨ë³„ ì´ê³„) â­ v6.0: ì£¼ì°¨ë³„ ì§€ê¸‰ëŒ€ì¥ ì—­í• 

**ëª©ì **: ì£¼ì°¨ë³„ ì „ì²´ ì§€ê¸‰ ì´ê³„ ë° í†µê³„ (ë¹ ë¥¸ ì¡°íšŒìš©) + **ì£¼ì°¨ë³„ ì§€ê¸‰ëŒ€ì¥ ê´€ë¦¬**

```javascript
{
  _id: ObjectId,
  weekNumber: String,            // ISO ì£¼ì°¨ (2025-W31)
  weekDate: Date,                // í•´ë‹¹ ê¸ˆìš”ì¼ ë‚ ì§œ
  monthKey: String,              // ì›” í‚¤ (2025-08)

  // ì§€ê¸‰ ì´ê³„
  totalAmount: Number,           // ì§€ê¸‰ ì´ì•¡
  totalTax: Number,              // ì›ì²œì§•ìˆ˜ ì´ì•¡
  totalNet: Number,              // ì‹¤ìˆ˜ë ¹ ì´ì•¡
  recipientCount: Number,        // ì§€ê¸‰ ëŒ€ìƒì ìˆ˜

  // í†µê³„
  status: String,                // 'pending' | 'paid' | 'processing'
  processedAt: Date,             // ì²˜ë¦¬ ì™„ë£Œ ì‹œê°

  createdAt: Date,
  updatedAt: Date
}
```

**v6.0 í•µì‹¬ ì—­í• :**
1. **ì£¼ì°¨ë³„ ì§€ê¸‰ëŒ€ì¥**: ë§¤ì£¼ ì§€ê¸‰ ëŒ€ìƒ ë° ê¸ˆì•¡ ê´€ë¦¬
2. **ê¸ˆìš”ì¼ ìë™ì²˜ë¦¬ ì¤‘ì‹¬**:
   - ì§€ê¸‰ ì²˜ë¦¬ í›„ Summary ì—…ë°ì´íŠ¸
   - 10íšŒ ì™„ë£Œì ì°¾ê¸°
   - ì¶”ê°€ ê³„íš ìƒì„± í›„ Summary ì¬ì—…ë°ì´íŠ¸
3. **ë¹ ë¥¸ ì¡°íšŒ**: ì£¼ì°¨ë³„ ì´ê³„ë¥¼ WeeklyPaymentPlans ì¡°íšŒ ì—†ì´ ì¦‰ì‹œ í™•ì¸
4. **í†µê³„ ê¸°ë°˜**: ëŒ€ì‹œë³´ë“œ, ë³´ê³ ì„œ ë“±ì—ì„œ ì‚¬ìš©

**ì—…ë°ì´íŠ¸ ì‹œì :**
- ë“±ë¡/ìŠ¹ê¸‰ ì‹œ: ì§€ê¸‰ ê³„íš ìƒì„± â†’ Summaryì— ì˜ˆìƒ ê¸ˆì•¡ ì¶”ê°€
- ê¸ˆìš”ì¼ ìë™ì²˜ë¦¬: ì‹¤ì œ ì§€ê¸‰ â†’ Summary ì—…ë°ì´íŠ¸
- ì¶”ê°€ ê³„íš ìƒì„±: ìƒˆ 10íšŒ ìƒì„± â†’ Summaryì— ë¯¸ë˜ ì£¼ì°¨ ì˜ˆìƒ ê¸ˆì•¡ ì¶”ê°€

**ì¸ë±ìŠ¤:**
- `weekNumber` (unique)
- `weekDate`
- `monthKey`
- `status`

---

## 3. ì§€ê¸‰ ê³„íš ì²˜ë¦¬ ë°©ì•ˆ

### 3.1 ì´ˆê¸° ê³„íš ìƒì„± (ë“±ë¡/ìŠ¹ê¸‰ ì‹œ) â­ v6.0 ë³€ê²½

#### 3.1.1 ë“±ë¡ ì‹œ Initial ê³„íš ìƒì„±

**ìƒì„± ì¡°ê±´:**
- ìš©ì—­ì ì‹ ê·œ ë“±ë¡ ì‹œ
- ë“±ê¸‰ ì¬ê³„ì‚° ì™„ë£Œ í›„

**ìƒì„± ë‚´ìš©:**
```javascript
{
  planType: 'initial',
  generation: 1,                 // ì²« ë²ˆì§¸ 10íšŒ â­
  baseGrade: user.grade,         // ë“±ë¡ ì‹œì  ë“±ê¸‰
  revenueMonth: '2025-07',       // ë“±ë¡ì›”
  totalInstallments: 10,         // 10íšŒ ê³ ì • â­
  installments: [
    {
      week: 1,
      weekNumber: '2025-W31',
      scheduledDate: new Date('2025-08-01'),
      installmentAmount: 24000,  // ë“±ë¡ì›” ë§¤ì¶œ ê¸°ì¤€
      installmentType: 'initial'
    },
    // ... 10ê°œ
  ]
}
```

**ë§¤ì¶œ ê¸°ì¤€:**
- ë“±ë¡ì›”(registrationDateì˜ YYYY-MM)ì˜ ë§¤ì¶œ
- `monthlyRegistrations`ì—ì„œ ì¡°íšŒ

**ì§€ê¸‰ ì‹œì‘ì¼:**
- ë“±ë¡ì¼ + 1ê°œì›” í›„ ì²« ê¸ˆìš”ì¼

#### 3.1.2 ìŠ¹ê¸‰ ì‹œ Promotion ê³„íš ìƒì„±

**ìƒì„± ì¡°ê±´:**
- ë“±ê¸‰ ì¬ê³„ì‚° í›„ ìŠ¹ê¸‰ í™•ì¸ë¨
- ê¸°ì¡´ ê³„íšì€ ì¤‘ë‹¨í•˜ì§€ ì•ŠìŒ (ë³‘í–‰ ì§€ê¸‰)

**ìƒì„± ë‚´ìš©:**
```javascript
{
  planType: 'promotion',
  generation: 1,                 // ìŠ¹ê¸‰ ì²« ë²ˆì§¸ 10íšŒ â­
  baseGrade: newGrade,           // ìŠ¹ê¸‰ í›„ ë“±ê¸‰
  revenueMonth: '2025-10',       // ìŠ¹ê¸‰ ì‹œì  ì›”
  totalInstallments: 10,         // 10íšŒ ê³ ì • â­
  installments: [
    {
      week: 1,
      weekNumber: '2025-W41',
      scheduledDate: new Date('2025-10-10'),
      installmentAmount: 81000,  // ìŠ¹ê¸‰ ì‹œì  ì›” ë§¤ì¶œ ê¸°ì¤€
      installmentType: 'initial'
    },
    // ... 10ê°œ
  ]
}
```

---

### 3.2 ì¶”ê°€ ê³„íš ìƒì„± (10íšŒ ì™„ë£Œ ì‹œ) â­ v6.0 ì‹ ê·œ

#### 3.2.1 ìƒì„± ì‹œì 

**ê¸ˆìš”ì¼ ìë™ì²˜ë¦¬ ì¤‘ í™•ì¸:**
```javascript
// ì§€ê¸‰ ì²˜ë¦¬ ì™„ë£Œ í›„
for (const plan of completedPlans) {
  if (plan.completedInstallments === 10) {
    // 10íšŒ ì™„ë£Œ ê°ì§€ â­
    await checkAndCreateAdditionalPlan(plan);
  }
}
```

#### 3.2.2 ìƒì„± ì¡°ê±´ í™•ì¸

**1ë‹¨ê³„: ìµœëŒ€ íšŸìˆ˜ í™•ì¸**
```javascript
const MAX_INSTALLMENTS = {
  F1: 20, F2: 30, F3: 40, F4: 40,
  F5: 50, F6: 50, F7: 60, F8: 60
};

// ì „ì²´ ì™„ë£Œ íšŒì°¨ ê³„ì‚°
const totalCompleted = await WeeklyPaymentPlans.aggregate([
  { $match: { userId, planStatus: 'completed' } },
  { $group: { _id: null, total: { $sum: '$totalInstallments' } } }
]);

const maxForGrade = MAX_INSTALLMENTS[currentGrade];
if (totalCompleted >= maxForGrade) {
  // ìµœëŒ€ íšŸìˆ˜ ë„ë‹¬ - ìƒì„± ì•ˆ í•¨
  return;
}
```

**2ë‹¨ê³„: ë“±ê¸‰ í™•ì¸**
```javascript
const currentGrade = user.grade;
const planGrade = plan.baseGrade;

if (currentGrade < planGrade) {
  // ë“±ê¸‰ í•˜ë½ - ìƒì„± ì•ˆ í•¨
  return;
}
```

**3ë‹¨ê³„: ë³´í—˜ í™•ì¸ (F3 ì´ìƒ)**
```javascript
if (currentGrade >= 'F3') {
  const insurance = user.insuranceSettings;
  if (!insurance || !insurance.maintained) {
    // ë³´í—˜ ë¯¸ê°€ì…/ë¯¸ìœ ì§€ - ìƒì„± ì•ˆ í•¨
    return;
  }
}
```

#### 3.2.3 ì¶”ê°€ ê³„íš ìƒì„±

**ì™„ë£Œ ë§¤ì¶œì›” ê³„ì‚°:**
```javascript
// 10íšŒì°¨ ì™„ë£Œ ì‹œì ì˜ ë‚ ì§œë¡œ ë§¤ì¶œì›” ê²°ì •
const lastInstallment = plan.installments[9]; // 10íšŒì°¨
const completionDate = lastInstallment.paidDate || lastInstallment.scheduledDate;
const revenueMonth = `${completionDate.getFullYear()}-${String(completionDate.getMonth() + 1).padStart(2, '0')}`;
```

**ìƒì„± ë‚´ìš©:**
```javascript
{
  planType: plan.planType,       // 'initial' | 'promotion' ìœ ì§€
  generation: plan.generation + 1, // ë‹¤ìŒ generation â­
  baseGrade: currentGrade,       // í˜„ì¬ ë“±ê¸‰
  revenueMonth: '2025-10',       // ì™„ë£Œ ë§¤ì¶œì›” â­
  totalInstallments: 10,
  parentPlanId: plan._id,        // ì´ì „ ê³„íš ì—°ê²° â­
  createdBy: 'auto_generation',  // ìë™ ìƒì„± í‘œì‹œ â­
  installments: [
    {
      week: 1,                   // ìƒˆë¡œìš´ 10íšŒ ì‹œì‘
      weekNumber: '2025-W42',
      scheduledDate: nextFriday, // ë‹¤ìŒ ê¸ˆìš”ì¼
      installmentAmount: newAmount, // ì™„ë£Œ ë§¤ì¶œì›” ê¸°ì¤€ ì¬ê³„ì‚° â­
      installmentType: 'initial'
    },
    // ... 10ê°œ
  ]
}
```

**ë§¤ì¶œ ê¸°ì¤€:**
- **ì™„ë£Œ ë§¤ì¶œì›”**ì˜ ë§¤ì¶œë¡œ ê¸ˆì•¡ ì¬ê³„ì‚°
- ë“±ê¸‰ì´ ìœ ì§€/ìƒìŠ¹í–ˆìœ¼ë©´ í˜„ì¬ ë“±ê¸‰ì˜ ê¸ˆì•¡ ì ìš©

**ì˜ˆì‹œ:**
```
F1 ë“±ê¸‰ 10íšŒ ì™„ë£Œ (2025-10-03):
- ì™„ë£Œ ë§¤ì¶œì›”: 2025-10
- 2025-10 ë§¤ì¶œ: 5,000,000ì›
- F1 ê¸°ì¤€ ê¸ˆì•¡: 400,000ì›
- 11~20íšŒì°¨: 400,000 Ã· 10 = 40,000ì›/íšŒ â­ (ë“±ë¡ ì‹œì™€ ë‹¤ë¦„)
```

---

### 3.3 ë³‘í–‰ ì§€ê¸‰ ê´€ë¦¬

#### 3.3.1 ë³‘í–‰ ì§€ê¸‰ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ 1: F1 ë“±ê¸‰ 20íšŒ ì™„ë£Œ â†’ F2 ìŠ¹ê¸‰**
```
íƒ€ì„ë¼ì¸:
- 2025-07-01: ë“±ë¡ (F1)
  â†’ Initial-Gen1 ìƒì„± (1~10íšŒ, F1 ê¸ˆì•¡)

- 2025-10-03: 10íšŒ ì™„ë£Œ
  â†’ ë“±ê¸‰ í™•ì¸: F2 ìŠ¹ê¸‰!
  â†’ Initial-Gen2 ìƒì„± (11~20íšŒ, F1 ê¸ˆì•¡, 2025-10 ë§¤ì¶œ)
  â†’ Promotion-Gen1 ìƒì„± (1~10íšŒ, F2 ê¸ˆì•¡, 2025-10 ë§¤ì¶œ)

- 2025-10-10: ì§€ê¸‰
  â†’ Initial-Gen2 11íšŒ: F1 ê¸ˆì•¡
  â†’ Promotion-Gen1 1íšŒ: F2 ê¸ˆì•¡
  â†’ ë³‘í–‰ ì§€ê¸‰ â­

- 2025-12-05: Initial 20íšŒ ì™„ë£Œ
  â†’ Initial-Gen3 ìƒì„±? X (F1 ìµœëŒ€ 20íšŒ ë„ë‹¬)
  â†’ Promotionì€ ê³„ì† ì§„í–‰

- 2026-01-02: Promotion 10íšŒ ì™„ë£Œ
  â†’ Promotion-Gen2 ìƒì„± (11~20íšŒ, F2 ê¸ˆì•¡, 2026-01 ë§¤ì¶œ)
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: F3 ë³´í—˜ ë¯¸ìœ ì§€ë¡œ ì¤‘ë‹¨**
```
íƒ€ì„ë¼ì¸:
- 2025-07-01: ë“±ë¡ (F3, ë³´í—˜ ê°€ì…)
  â†’ Initial-Gen1 ìƒì„± (1~10íšŒ)

- 2025-10-03: 10íšŒ ì™„ë£Œ
  â†’ ë“±ê¸‰: F3 ìœ ì§€
  â†’ ë³´í—˜: ë¯¸ê°€ì… âŒ
  â†’ Initial-Gen2 ìƒì„± ì•ˆ í•¨

- 2025-11-01: ë³´í—˜ ì¬ê°€ì…
  â†’ ë‹¤ìŒ 10íšŒ ì™„ë£Œ ì‹œì ì— í™•ì¸

- 2026-01-05: (ë‹¤ë¥¸ ê³„íšì˜) 10íšŒ ì™„ë£Œ
  â†’ ë“±ê¸‰: F3 ìœ ì§€
  â†’ ë³´í—˜: ê°€ì… ì¤‘ âœ…
  â†’ ì¶”ê°€ ê³„íš ìƒì„±
```

---

## 4. ìë™í™” í”„ë¡œì„¸ìŠ¤

### 4.1 ê¸ˆìš”ì¼ ìë™ ì§€ê¸‰ í”„ë¡œì„¸ìŠ¤ â­ v6.0 ë³€ê²½

**ì‹¤í–‰ ì‹œì :** ë§¤ì£¼ ê¸ˆìš”ì¼ 00:00

**ì²˜ë¦¬ íë¦„:**

```javascript
async function processFridayPayments() {
  const today = new Date();
  const weekNumber = getISOWeek(today);

  // === 1ë‹¨ê³„: ì§€ê¸‰ ì²˜ë¦¬ ===
  const plans = await WeeklyPaymentPlans.find({
    'installments': {
      $elemMatch: {
        weekNumber: weekNumber,
        status: 'pending'
      }
    }
  });

  for (const plan of plans) {
    // ì§€ê¸‰ ëŒ€ìƒ í• ë¶€ ì°¾ê¸°
    const installment = plan.installments.find(
      inst => inst.weekNumber === weekNumber && inst.status === 'pending'
    );

    // ë³´í—˜ í™•ì¸ (F3 ì´ìƒ)
    const user = await User.findOne({ loginId: plan.userId });
    if (user.grade >= 'F3' && !user.insuranceSettings?.maintained) {
      installment.status = 'skipped';
      installment.insuranceSkipped = true;
      continue;
    }

    // ì§€ê¸‰ ì²˜ë¦¬
    installment.status = 'paid';
    installment.paidDate = today;
    installment.gradeAtPayment = user.grade;

    plan.completedInstallments++;

    // ê³„íš ì™„ë£Œ í™•ì¸
    if (plan.completedInstallments === plan.totalInstallments) {
      plan.planStatus = 'completed';
    }

    await plan.save();
  }

  // === 2ë‹¨ê³„: WeeklyPaymentSummary ì—…ë°ì´íŠ¸ ===
  await updateWeeklySummary(weekNumber, plans);

  // === 3ë‹¨ê³„: 10íšŒ ì™„ë£Œ í™•ì¸ ë° ì¶”ê°€ ê³„íš ìƒì„± â­ v6.0 ì‹ ê·œ ===
  // Summaryì—ì„œ ì´ë²ˆ ì£¼ì— 10íšŒ ì™„ë£Œëœ ê³„íš ì°¾ê¸°
  const completedPlans = plans.filter(p =>
    p.completedInstallments === 10 && p.planStatus === 'completed'
  );

  for (const plan of completedPlans) {
    await checkAndCreateAdditionalPlan(plan);
  }
}

// ì¶”ê°€ ê³„íš ìƒì„± ë¡œì§ â­ v6.0 ì‹ ê·œ
async function checkAndCreateAdditionalPlan(plan) {
  const user = await User.findOne({ loginId: plan.userId });

  // 1. ìµœëŒ€ íšŸìˆ˜ í™•ì¸
  const MAX_INSTALLMENTS = { F1: 20, F2: 30, F3: 40, F4: 40, F5: 50, F6: 50, F7: 60, F8: 60 };
  const totalCompleted = await calculateTotalCompletedInstallments(plan.userId);

  if (totalCompleted >= MAX_INSTALLMENTS[user.grade]) {
    console.log(`[${plan.userId}] ìµœëŒ€ íšŸìˆ˜ ë„ë‹¬ - ì¶”ê°€ ìƒì„± ì•ˆ í•¨`);
    return;
  }

  // 2. ë“±ê¸‰ í™•ì¸
  if (user.grade < plan.baseGrade) {
    console.log(`[${plan.userId}] ë“±ê¸‰ í•˜ë½ - ì¶”ê°€ ìƒì„± ì•ˆ í•¨`);
    return;
  }

  // 3. ë³´í—˜ í™•ì¸ (F3 ì´ìƒ)
  if (user.grade >= 'F3' && !user.insuranceSettings?.maintained) {
    console.log(`[${plan.userId}] ë³´í—˜ ë¯¸ê°€ì… - ì¶”ê°€ ìƒì„± ì•ˆ í•¨`);
    return;
  }

  // 4. ì™„ë£Œ ë§¤ì¶œì›” ê³„ì‚°
  const lastInstallment = plan.installments[9]; // 10íšŒì°¨
  const completionDate = lastInstallment.paidDate || lastInstallment.scheduledDate;
  const revenueMonth = `${completionDate.getFullYear()}-${String(completionDate.getMonth() + 1).padStart(2, '0')}`;

  // 5. ë§¤ì¶œ ì¡°íšŒ ë° ê¸ˆì•¡ ê³„ì‚°
  const monthlyReg = await MonthlyRegistrations.findOne({ monthKey: revenueMonth });
  if (!monthlyReg) {
    console.log(`[${plan.userId}] ë§¤ì¶œ ì •ë³´ ì—†ìŒ - ì¶”ê°€ ìƒì„± ì•ˆ í•¨`);
    return;
  }

  const revenue = monthlyReg.getEffectiveRevenue();
  const gradePayments = calculateGradePayments(revenue, monthlyReg.gradeDistribution);
  const baseAmount = gradePayments[user.grade];
  const installmentAmount = Math.floor(baseAmount / 10 / 100) * 100;

  // 6. ì¶”ê°€ 10íšŒ ê³„íš ìƒì„±
  const nextGeneration = plan.generation + 1;
  const startDate = getNextFriday(completionDate);

  const installments = [];
  for (let i = 1; i <= 10; i++) {
    const scheduledDate = new Date(startDate);
    scheduledDate.setDate(scheduledDate.getDate() + (i - 1) * 7);

    installments.push({
      week: i,
      weekNumber: getISOWeek(scheduledDate),
      scheduledDate,
      revenueMonth,
      gradeAtPayment: null,
      baseAmount,
      installmentAmount,
      withholdingTax: Math.round(installmentAmount * 0.033),
      netAmount: installmentAmount - Math.round(installmentAmount * 0.033),
      status: 'pending',
      insuranceSkipped: false,
      installmentType: 'initial'
    });
  }

  // 7. DB ì €ì¥
  const newPlan = await WeeklyPaymentPlans.create({
    userId: plan.userId,
    userName: plan.userName,
    planType: plan.planType,
    generation: nextGeneration,
    baseGrade: user.grade,
    revenueMonth,
    startDate,
    totalInstallments: 10,
    completedInstallments: 0,
    planStatus: 'active',
    installments,
    parentPlanId: plan._id,
    createdBy: 'auto_generation'
  });

  console.log(`[${plan.userId}] ì¶”ê°€ ê³„íš ìƒì„± ì™„ë£Œ - Generation ${nextGeneration}`);

  // 8. ì£¼ì°¨ë³„ ì´ê³„ ì—…ë°ì´íŠ¸
  await updateWeeklyProjections(newPlan, 'add');

  return newPlan;
}
```

---

### 4.2 ìš©ì—­ì ë“±ë¡ í”„ë¡œì„¸ìŠ¤

```javascript
async function processUserRegistration(userIds) {
  // 1. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  const users = await User.find({ _id: { $in: userIds } });

  // 2. ë“±ê¸‰ ì¬ê³„ì‚° (ë¨¼ì € ì‹¤í–‰!)
  const gradeChangeResult = await recalculateAllGrades();
  const affectedUsers = gradeChangeResult.changedUsers || [];

  // 3. ë“±ê¸‰ ì¬ê³„ì‚° í›„ users ì •ë³´ ë‹¤ì‹œ ì¡°íšŒ (ìµœì‹  ë“±ê¸‰ ë°˜ì˜)
  const updatedUsers = await User.find({ _id: { $in: userIds } });

  // 4. ì›”ë³„ ë“±ë¡ ì •ë³´ ì—…ë°ì´íŠ¸ (ìµœì‹  ë“±ê¸‰ìœ¼ë¡œ)
  await updateMonthlyRegistrations(updatedUsers);

  // 5. ì›”ë³„ íŠ¸ë¦¬ ìŠ¤ëƒ…ìƒ· ì—…ë°ì´íŠ¸
  await updateMonthlyTreeSnapshots(updatedUsers, affectedUsers);

  // 6. ì§€ê¸‰ ê³„íš ì²˜ë¦¬
  const paymentPlanResults = [];

  // 6-1. ì‹ ê·œ ë“±ë¡ì Initial ê³„íš ìƒì„± (10íšŒë§Œ) â­
  for (const user of updatedUsers) {
    const plan = await createInitialPaymentPlan(
      user.loginId,
      user.name,
      user.grade,
      user.registrationDate || user.createdAt
    );
    paymentPlanResults.push({ userId: user.loginId, type: 'initial', plan: plan._id });
  }

  // 6-2. ìŠ¹ê¸‰ì Promotion ê³„íš ìƒì„± (10íšŒë§Œ) â­
  const promotedUsers = affectedUsers.filter(u =>
    u.changeType === 'grade_change' && u.oldGrade && u.newGrade && u.oldGrade < u.newGrade
  );

  for (const promoted of promotedUsers) {
    const user = await User.findOne({ loginId: promoted.userId });
    const plan = await createPromotionPaymentPlan(
      user.loginId,
      user.name,
      promoted.newGrade,
      new Date()
    );
    paymentPlanResults.push({ userId: user.loginId, type: 'promotion', plan: plan._id });
  }

  return {
    success: true,
    registeredUsers: updatedUsers.length,
    affectedUsers: affectedUsers.length,
    promotedUsers: promotedUsers.length,
    paymentPlans: paymentPlanResults
  };
}
```

---

## 5. ì›¹ API ì„¤ê³„

### 5.1 ìš©ì—­ë¹„ ì§€ê¸‰ëª…ë¶€ ì¡°íšŒ API

#### 5.1.1 ë‹¨ì¼ ì£¼ì°¨ ì¡°íšŒ

**GET** `/api/admin/payment/weekly?year=2025&month=10&week=2`

**ì‘ë‹µ:**
```json
{
  "success": true,
  "data": {
    "grandTotal": {
      "totalAmount": 105000,
      "totalTax": 3465,
      "totalNet": 101535
    },
    "week": "2025ë…„ 10ì›” 2ì£¼",
    "weekNumber": "2025-W41",
    "payments": [
      {
        "no": 1,
        "userId": "ì‚¬ì¥ë‹˜",
        "userName": "ì‚¬ì¥ë‹˜",
        "grade": "F2",
        "actualAmount": 105000,
        "taxAmount": 3465,
        "netAmount": 101535,
        "installments": [
          {
            "planType": "initial",
            "generation": 2,
            "week": 11,
            "revenueMonth": "2025-10",
            "amount": 24000,
            "tax": 792,
            "net": 23208
          },
          {
            "planType": "promotion",
            "generation": 1,
            "week": 1,
            "revenueMonth": "2025-10",
            "amount": 81000,
            "tax": 2673,
            "net": 78327
          }
        ]
      }
    ],
    "pagination": {
      "page": 1,
      "totalPages": 1,
      "totalItems": 3,
      "itemsPerPage": 20
    }
  }
}
```

#### 5.1.2 ê¸°ê°„ ì¡°íšŒ

**GET** `/api/admin/payment/weekly?startYear=2025&startMonth=10&endYear=2025&endMonth=12`

**ì‘ë‹µ:**
```json
{
  "success": true,
  "data": {
    "grandTotal": {
      "totalAmount": 1050000,
      "totalTax": 34650,
      "totalNet": 1015350
    },
    "period": {
      "start": "2025ë…„ 10ì›”",
      "end": "2025ë…„ 12ì›”",
      "weekCount": 13
    },
    "weeks": [
      {
        "year": 2025,
        "monthNumber": 10,
        "weekNumber": 1,
        "week": "2025ë…„ 10ì›” 1ì£¼",
        "payments": [
          {
            "userId": "ì‚¬ì¥ë‹˜",
            "userName": "ì‚¬ì¥ë‹˜",
            "grade": "F2",
            "actualAmount": 105000,
            "installments": [
              {
                "planType": "initial",
                "generation": 2,
                "week": 11,
                "revenueMonth": "2025-10"
              }
            ]
          }
        ]
      }
    ],
    "payments": [
      {
        "no": 1,
        "userId": "ì‚¬ì¥ë‹˜",
        "userName": "ì‚¬ì¥ë‹˜",
        "grade": "F2",
        "totalAmount": 1050000,
        "totalTax": 34650,
        "totalNet": 1015350,
        "paymentCount": 26
      }
    ],
    "pagination": {
      "page": 1,
      "totalPages": 1,
      "totalItems": 3,
      "itemsPerPage": 20
    }
  }
}
```

---

## 6. ë°ì´í„° íë¦„ë„

### 6.1 ë“±ë¡ ì‹œ ë°ì´í„° íë¦„

```
[ì—‘ì…€ ì—…ë¡œë“œ/ê°œë³„ ë“±ë¡]
    â†“
[User ìƒì„±/ì €ì¥]
    â†“
[ë“±ê¸‰ ì¬ê³„ì‚°]
    â†“
[MonthlyRegistrations ì—…ë°ì´íŠ¸]
    - ë“±ë¡ì ì •ë³´ ì¶”ê°€ (ìµœì‹  ë“±ê¸‰)
    - ë§¤ì¶œ ê³„ì‚°
    - ë“±ê¸‰ë³„ ë°°ë¶„ì•¡ ê³„ì‚°
    â†“
[MonthlyTreeSnapshots ì—…ë°ì´íŠ¸]
    - íŠ¸ë¦¬ êµ¬ì¡° ìŠ¤ëƒ…ìƒ·
    - ë“±ê¸‰ ë¶„í¬
    â†“
[WeeklyPaymentPlans ìƒì„±] â­ 10íšŒë§Œ
    - planType: 'initial'
    - generation: 1
    - totalInstallments: 10
    - revenueMonth: ë“±ë¡ì›”
    â†“
[WeeklyPaymentSummary ì—…ë°ì´íŠ¸]
    - ì£¼ì°¨ë³„ ì˜ˆìƒ ì´ê³„ ì—…ë°ì´íŠ¸
```

### 6.2 ê¸ˆìš”ì¼ ìë™ì²˜ë¦¬ ë°ì´í„° íë¦„ â­ v6.0: WeeklyPaymentSummary ì¤‘ì‹¬ ê´€ë¦¬

```
[ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰: ë§¤ì£¼ ê¸ˆìš”ì¼ 00:00]
    â†“
[1ë‹¨ê³„: í•´ë‹¹ ì£¼ì°¨ ì§€ê¸‰ ëŒ€ìƒ ì¡°íšŒ]
    - WeeklyPaymentPlansì—ì„œ weekNumberë¡œ í•„í„°ë§
    - installments.status: 'pending'
    â†“
[1ë‹¨ê³„: ì§€ê¸‰ ì²˜ë¦¬]
    - ë³´í—˜ í™•ì¸ (F3 ì´ìƒ)
    - status: 'pending' â†’ 'paid'
    - completedInstallments++
    - planStatus: ì™„ë£Œ ì‹œ 'completed'
    â†“
[2ë‹¨ê³„: WeeklyPaymentSummary ì—…ë°ì´íŠ¸] â­ ì£¼ì°¨ë³„ ì§€ê¸‰ëŒ€ì¥
    - ì‹¤ì œ ì§€ê¸‰ì•¡ ì§‘ê³„
    - totalAmount, totalTax, totalNet ì—…ë°ì´íŠ¸
    - recipientCount ì—…ë°ì´íŠ¸
    - status: 'paid', processedAt ê¸°ë¡
    â†“
[3ë‹¨ê³„: 10íšŒ ì™„ë£Œ í™•ì¸] â­ v6.0 ì‹ ê·œ
    - ì´ë²ˆ ì£¼ ì§€ê¸‰ëœ ê³„íš ì¤‘
    - completedInstallments === 10?
    - planStatus === 'completed'?
    â†“
[3ë‹¨ê³„: ì¶”ê°€ ê³„íš ìƒì„± ì¡°ê±´ í™•ì¸] â­ v6.0 ì‹ ê·œ
    FOR EACH completedPlan:
      â”œâ”€ ìµœëŒ€ íšŸìˆ˜ í™•ì¸ (F1:20, F2:30, ...)
      â”œâ”€ ë“±ê¸‰ ìœ ì§€/ìƒìŠ¹ í™•ì¸
      â””â”€ ë³´í—˜ ìœ ì§€ í™•ì¸ (F3 ì´ìƒ)
    â†“
[3ë‹¨ê³„: ì™„ë£Œ ë§¤ì¶œì›” ê¸°ì¤€ ê¸ˆì•¡ ê³„ì‚°] â­ v6.0 ì‹ ê·œ
    - 10íšŒì°¨ ì™„ë£Œì¼ â†’ revenueMonth (YYYY-MM)
    - MonthlyRegistrationsì—ì„œ ë§¤ì¶œ ì¡°íšŒ
    - í˜„ì¬ ë“±ê¸‰ ê¸°ì¤€ ë°°ë¶„ì•¡ ê³„ì‚°
    - installmentAmount = baseAmount Ã· 10
    â†“
[3ë‹¨ê³„: ì¶”ê°€ 10íšŒ ê³„íš ìƒì„±] â­ v6.0 ì‹ ê·œ
    - WeeklyPaymentPlans.create({
        generation: N+1,
        revenueMonth: ì™„ë£Œ ë§¤ì¶œì›”,
        parentPlanId: ì´ì „ ê³„íš ID,
        createdBy: 'auto_generation',
        totalInstallments: 10
      })
    â†“
[3ë‹¨ê³„: WeeklyPaymentSummary ì¬ì—…ë°ì´íŠ¸] â­ v6.0 ì‹ ê·œ
    - ì‹ ê·œ ìƒì„±ëœ ê³„íšì˜ ë¯¸ë˜ ì£¼ì°¨ì—
    - ì˜ˆìƒ ì§€ê¸‰ì•¡ ì¶”ê°€ (incrementPayment)
    - ì§€ê¸‰ëŒ€ìƒì ìˆ˜ ì—…ë°ì´íŠ¸
    â†“
[ì™„ë£Œ: ë¡œê¹… ë° ì•Œë¦¼]
    - ì§€ê¸‰ ì™„ë£Œ ë¡œê·¸
    - 10íšŒ ì™„ë£Œ ì•Œë¦¼
    - ì¶”ê°€ ê³„íš ìƒì„± ë¡œê·¸
    - ì¡°ê±´ ë¯¸ì¶©ì¡± ì•Œë¦¼
```

**í•µì‹¬ í¬ì¸íŠ¸:**
- **WeeklyPaymentSummary**ê°€ ì£¼ì°¨ë³„ ì§€ê¸‰ëŒ€ì¥ ì—­í• 
- ê¸ˆìš”ì¼ ì²˜ë¦¬: **ì§€ê¸‰ â†’ Summary ì—…ë°ì´íŠ¸ â†’ 10íšŒ ì™„ë£Œ í™•ì¸ â†’ ì¶”ê°€ ê³„íš ìƒì„± â†’ Summary ì¬ì—…ë°ì´íŠ¸**
- Summaryë¥¼ í†µí•´ ë§¤ì£¼ ì§€ê¸‰ ëŒ€ìƒ ë° ê¸ˆì•¡ ê´€ë¦¬

### 6.3 ìŠ¹ê¸‰ ì‹œ ë°ì´í„° íë¦„

```
[ë“±ê¸‰ ì¬ê³„ì‚°]
    â†“
[ìŠ¹ê¸‰ ê°ì§€]
    â†“
[ê¸°ì¡´ ê³„íš í™•ì¸]
    - ì§„í–‰ ì¤‘ì¸ ê³„íš ìœ ì§€ (ì¤‘ë‹¨ ì•ˆ í•¨)
    â†“
[Promotion ê³„íš ìƒì„±] â­ 10íšŒë§Œ
    - planType: 'promotion'
    - generation: 1
    - totalInstallments: 10
    - revenueMonth: ìŠ¹ê¸‰ ì‹œì  ì›”
    â†“
[ë³‘í–‰ ì§€ê¸‰ ì‹œì‘]
    - ê¸°ì¡´ ê³„íš + ì‹ ê·œ ê³„íš ë™ì‹œ ì§„í–‰
```

---

## 7. v5.0 â†’ v6.0 ë³€ê²½ì‚¬í•­ ìš”ì•½

| í•­ëª© | v5.0 | v6.0 |
|------|------|------|
| **ë“±ë¡ ì‹œ ê³„íš ìƒì„±** | ìµœëŒ€ íšŸìˆ˜ ì „ì²´ ì‚¬ì „ ìƒì„± | 10íšŒë§Œ ìƒì„± |
| **ì¶”ê°€ ê³„íš ìƒì„±** | ì‚¬ì „ ìƒì„± (ë¯¸ë˜ ì˜ˆì¸¡) | 10íšŒ ì™„ë£Œ ì‹œì ì— ë™ì  ìƒì„± |
| **ë§¤ì¶œ ê¸°ì¤€** | ë“±ë¡ì›” ë§¤ì¶œë¡œ ì „ì²´ | ê° 10íšŒ ì™„ë£Œ ì‹œì  ë§¤ì¶œì›” |
| **ê¸ˆìš”ì¼ ì²˜ë¦¬** | ì§€ê¸‰ë§Œ | ì§€ê¸‰ + 10íšŒ ì™„ë£Œ í™•ì¸ + ì¶”ê°€ ìƒì„± |
| **ì¡°ê±´ í™•ì¸** | ë“±ë¡ ì‹œ 1íšŒ | ë§¤ 10íšŒ ì™„ë£Œë§ˆë‹¤ |
| **generation í•„ë“œ** | ì—†ìŒ | ì¶”ê°€ (ëª‡ ë²ˆì§¸ 10íšŒì¸ì§€) |
| **parentPlanId** | ì—†ìŒ | ì¶”ê°€ (ì´ì „ ê³„íš ì—°ê²°) |
| **createdBy** | ì—†ìŒ | ì¶”ê°€ (ìƒì„± ì¶œì²˜ êµ¬ë¶„) |

---

## 8. êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: í•µì‹¬ ë¡œì§ ë³€ê²½
1. âœ… WeeklyPaymentPlans ìŠ¤í‚¤ë§ˆ ìˆ˜ì • (generation, parentPlanId, createdBy ì¶”ê°€)
2. âœ… createInitialPaymentPlan: 10íšŒë§Œ ìƒì„±í•˜ë„ë¡ ìˆ˜ì •
3. âœ… createPromotionPaymentPlan: 10íšŒë§Œ ìƒì„±í•˜ë„ë¡ ìˆ˜ì •
4. âœ… checkAndCreateAdditionalPlan: ìƒˆ í•¨ìˆ˜ êµ¬í˜„
5. âœ… processFridayPayments: 10íšŒ ì™„ë£Œ í™•ì¸ ë¡œì§ ì¶”ê°€

### Phase 2: API ë° UI
1. âœ… API ì‘ë‹µì— generation, planType ì •ë³´ ì¶”ê°€
2. âœ… ì§€ê¸‰ëª…ë¶€ì— generation í‘œì‹œ
3. âœ… 10íšŒ ì™„ë£Œ ì•Œë¦¼ ê¸°ëŠ¥

### Phase 3: ëª¨ë‹ˆí„°ë§ ë° ìµœì í™”
1. âœ… ì¶”ê°€ ê³„íš ìƒì„± ë¡œê·¸
2. âœ… ì¡°ê±´ ë¯¸ì¶©ì¡± ì•Œë¦¼
3. âœ… ì„±ëŠ¥ ìµœì í™”

---

**ë¬¸ì„œ ë²„ì „ íˆìŠ¤í† ë¦¬:**

- v6.0 (2025-10-11): ë™ì  ì§€ê¸‰ ê³„íš ìƒì„± ë°©ì‹ìœ¼ë¡œ ë³€ê²½
- v5.0 (2025-10-11): ë³‘í–‰ ì§€ê¸‰ ë° ì¶”ê°€ ì§€ê¸‰ê¸°ê°„ ë„ì…
- v4.0 (2025-09-20): ë“±ê¸‰ë³„ ìµœëŒ€ ìˆ˜ë ¹ íšŸìˆ˜ ì¶”ê°€
- v3.0 (2025-09-15): ì£¼ì°¨ë³„ ì´ê³„ ì»¬ë ‰ì…˜ ì¶”ê°€
- v2.0 (2025-09-10): ì›”ë³„ ìŠ¤ëƒ…ìƒ· êµ¬ì¡° ê°œì„ 
- v1.0 (2025-09-01): ì´ˆê¸° ë²„ì „
