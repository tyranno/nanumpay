# ì›¹ ë°±ì—… ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ

**ë‚ ì§œ**: 2025-10-26
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ¯ êµ¬í˜„ ë‚´ìš©

ì›¹ UIì—ì„œ **ì¦‰ì‹œ ë°±ì—… ì‹¤í–‰ ë° ë‹¤ìš´ë¡œë“œ** ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

1. **ì›¹ UI ë²„íŠ¼ í´ë¦­**ìœ¼ë¡œ ì¦‰ì‹œ ë°±ì—… ì‹¤í–‰
2. **ìë™ ë‹¤ìš´ë¡œë“œ**: ë°±ì—… ì™„ë£Œ í›„ ë¸Œë¼ìš°ì €ì— ìë™ ë‹¤ìš´ë¡œë“œ
3. **ì‹¤ì‹œê°„ ìƒíƒœ**: ë°±ì—… ì§„í–‰ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ

---

## ğŸ“ ì‚¬ìš© ë°©ë²•

### ê°„ë‹¨ ì‚¬ìš©ë²•

1. ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸: http://localhost:3100/admin
2. ë©”ë‰´: **ê´€ë¦¬ì ì„¤ì •** â†’ **ì‹œìŠ¤í…œ ì„¤ì •** íƒ­
3. **"ì¦‰ì‹œ ë°±ì—… ë° ë‹¤ìš´ë¡œë“œ"** ë²„íŠ¼ í´ë¦­
4. ë°±ì—… ì™„ë£Œ â†’ ìë™ ë‹¤ìš´ë¡œë“œ

### íŒŒì¼ ì •ë³´

- **íŒŒì¼ëª…**: `nanumpay-backup-YYYY-MM-DDTHH-MM-SS.tar.gz`
- **í˜•ì‹**: gzip ì••ì¶• (tar.gz)
- **ë‚´ìš©**: MongoDB ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤

---

## ğŸ”§ êµ¬í˜„ íŒŒì¼

### 1. API ì—”ë“œí¬ì¸íŠ¸ (2ê°œ)

#### POST `/api/admin/backup/execute`
- **íŒŒì¼**: [apps/web/src/routes/api/admin/backup/execute/+server.js](../apps/web/src/routes/api/admin/backup/execute/+server.js)
- **ê¸°ëŠ¥**: ë°±ì—… ì•± ì‹¤í–‰ ë° íŒŒì¼ ìƒì„±

#### GET `/api/admin/backup/download?file={filename}`
- **íŒŒì¼**: [apps/web/src/routes/api/admin/backup/download/+server.js](../apps/web/src/routes/api/admin/backup/download/+server.js)
- **ê¸°ëŠ¥**: ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ìŠ¤íŠ¸ë¦¬ë°)

### 2. UI ì»´í¬ë„ŒíŠ¸

- **íŒŒì¼**: [apps/web/src/routes/(admin)/admin/settings/+page.svelte](../apps/web/src/routes/(admin)/admin/settings/+page.svelte)
- **ë³€ê²½ì‚¬í•­**:
  - "ì¦‰ì‹œ ë°±ì—… ë° ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ ì¶”ê°€
  - ë°±ì—… ì§„í–‰ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
  - ìë™ ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬

### 3. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

- **íŒŒì¼**: [scripts/test/test_web_backup_download.sh](../scripts/test/test_web_backup_download.sh)
- **ê¸°ëŠ¥**: ì „ì²´ í”Œë¡œìš° ìë™/ìˆ˜ë™ í…ŒìŠ¤íŠ¸

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ì„œë²„ ì‹œì‘

```bash
# ë°±ì—… ê²½ë¡œ í™˜ê²½ë³€ìˆ˜ì™€ í•¨ê»˜ ì„œë²„ ì‹œì‘ (í•„ìˆ˜!)
BACKUP_PATH=/tmp/nanumpay-backups pnpm dev:web --host
```

### í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
bash scripts/test/test_web_backup_download.sh
```

ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì ˆì°¨ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.

---

## ğŸ” ë³´ì•ˆ ê¸°ëŠ¥

### ì ‘ê·¼ ì œì–´
- âœ… ê´€ë¦¬ì ê¶Œí•œ í•„ìˆ˜
- âœ… JWT í† í° ì¸ì¦

### íŒŒì¼ ë³´ì•ˆ
- âœ… ê²½ë¡œ ì¡°ì‘ ë°©ì§€ (`..`, `/`, `\` ì°¨ë‹¨)
- âœ… íŒŒì¼ëª… íŒ¨í„´ ê²€ì¦
- âœ… ë°±ì—… ë””ë ‰í† ë¦¬ ë‚´ë¶€ë§Œ ì ‘ê·¼

---

## ğŸ“Š ê¸°ìˆ  ìŠ¤íƒ

- **ë°±ì—”ë“œ**: SvelteKit API Routes
- **ì¸ì¦**: JWT (JSON Web Token)
- **íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë°**: Node.js fs.createReadStream â†’ ReadableStream
- **ë°±ì—… ì•±**: Bun ë¹Œë“œ (standalone binary)
- **ì••ì¶•**: gzip (tar.gz)

---

## ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ

### 1. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```bash
# /etc/nanumpay/nanumpay.env
BACKUP_PATH=/opt/nanumpay/backups
```

### 2. ë””ë ‰í† ë¦¬ ê¶Œí•œ

```bash
sudo mkdir -p /opt/nanumpay/backups
sudo chown -R nanumpay:nanumpay /opt/nanumpay/backups
sudo chmod 755 /opt/nanumpay/backups
```

### 3. Nginx ì„¤ì • (ì„ íƒ)

```nginx
# ëŒ€ìš©ëŸ‰ ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ í—ˆìš©
client_max_body_size 100M;
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

1. **ìƒì„¸ ë¬¸ì„œ**: [ì›¹_ë°±ì—…_ë‹¤ìš´ë¡œë“œ_ê¸°ëŠ¥.md](ì›¹_ë°±ì—…_ë‹¤ìš´ë¡œë“œ_ê¸°ëŠ¥.md)
2. **ë°±ì—… ì‹œìŠ¤í…œ**: [ë°±ì—…_ì‹œìŠ¤í…œ_ìµœì¢…_í†µí•©.md](ë°±ì—…_ì‹œìŠ¤í…œ_ìµœì¢…_í†µí•©.md)
3. **Nginx ì„¤ì •**: [Nginx_ë¦¬ë²„ìŠ¤í”„ë¡ì‹œ_í†µí•©.md](Nginx_ë¦¬ë²„ìŠ¤í”„ë¡ì‹œ_í†µí•©.md)

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ë°±ì—… ì‹¤í–‰ API (`POST /api/admin/backup/execute`)
- [x] ë‹¤ìš´ë¡œë“œ API (`GET /api/admin/backup/download`)
- [x] UI ë²„íŠ¼ ì¶”ê°€ (ê´€ë¦¬ì ì„¤ì •)
- [x] ì‹¤ì‹œê°„ ìƒíƒœ ë©”ì‹œì§€
- [x] ìë™ ë‹¤ìš´ë¡œë“œ
- [x] ê¶Œí•œ í™•ì¸ (ê´€ë¦¬ì ì „ìš©)
- [x] ë³´ì•ˆ ê²€ì¦ (ê²½ë¡œ ì¡°ì‘ ë°©ì§€)
- [x] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [x] ë¬¸ì„œí™”

---

**ğŸ‰ ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!**

ê´€ë¦¬ìëŠ” ì´ì œ ì›¹ UIì—ì„œ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ì¦‰ì‹œ ë°±ì—…í•˜ê³  ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
