# MLM 등급 계산 룰

## 등급 체계
- **F1**: 말단 등급 (자식이 없는 노드)
- **F2**: 좌우 서브트리에 각각 최소 1개의 F1
- **F3**: 좌우 서브트리에 각각 최소 1개의 F2
- **F4**: 좌우 서브트리에 각각 최소 1개의 F3
- **F5**: 좌우 서브트리의 F4가 **최소 2:1 조건** (총 3개 이상)
- **F6**: 좌우 서브트리의 F5가 **최소 2:1 조건** (총 3개 이상)
- **F7**: 좌우 서브트리의 F6이 **최소 2:1 조건** (총 3개 이상)
- **F8**: 좌우 서브트리의 F7이 **최소 2:1 조건** (총 3개 이상)

## 핵심 룰

### 1. 이진트리 구조
- 각 사용자는 최대 2명의 직속 하위자를 가질 수 있음
- 좌측/우측 자식으로 구성된 이진트리 형태

### 2. 등급 승급 조건

#### F1~F4: 각 서브트리 조건
- 좌우 서브트리에 **각각** 해당 등급이 최소 1개씩 존재

#### F5~F8: 최소 2:1 조건
- **중요**: 2:1은 정확한 비율이 아닌 **최소 조건**
- 한쪽에 최소 2개, 다른 쪽에 최소 1개
- 예시:
  - ✅ 2:1 (만족)
  - ✅ 3:1 (만족)
  - ✅ 3:2 (만족)
  - ✅ 4:2 (만족)
  - ❌ 1:1 (불만족 - 최소 조건 미달)
  - ❌ 2:0 (불만족 - 한쪽이 0개)

### 3. 계산 순서
1. 말단 노드부터 F1 등급 부여
2. 하위 등급부터 상위 등급 순으로 계산
3. 각 노드에서 조건을 만족하는 최고 등급 부여

## 예시 구조
```
      사장님(F5)
     /          \
  김영수(F5)    이미영(F4)
   /    \        /    \
 F4(3개) F3   F4(2개) F3
```

**사장님의 F5 조건:**
- 좌쪽 서브트리: F4가 3개
- 오른쪽 서브트리: F4가 2개
- 총 5개 (≥3개) ✅
- 3:2 비율 (≥2:1) ✅
- **결과: F5 만족**

## 구현 위치
- `src/lib/server/services/gradeCalculation.js`
- `calculateUserGrade()` 함수에서 등급 계산 로직 구현
- 엑셀 업로드 시 자동으로 등급 재계산 실행