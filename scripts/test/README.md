# í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

v7.0 ìš©ì—­ì ë“±ë¡ ë° ì§€ê¸‰ ê³„íš ìƒì„± í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒ

## ì‚¬ìš© ì „ ì¤€ë¹„

### 1. DB ì´ˆê¸°í™”
```bash
DB_DIR=/home/tyranno/project/bill/nanumpay/apps/web/install/linux/db \
bash /home/tyranno/project/bill/nanumpay/apps/web/install/linux/db_init.sh --force
```

### 2. ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
pnpm dev:web --host
```

## í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ëª©ë¡

### â­ test_step_by_step_auto.py (ê¶Œì¥)
**ì„¤ëª…**: í•œ ëª…ì”© ìë™ ë“±ë¡í•˜ê³  ê° ë‹¨ê³„ë§ˆë‹¤ DB ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” í†µí•© í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:
- 7ì›” 3ëª…: ì‚¬ì¥ë‹˜, ê¹€ì˜ìˆ˜, ì´ë¯¸ì˜
- 8ì›” 3ëª…: ë°•ì² ìˆ˜, ìµœì˜í¬, ì •ë¯¼ìˆ˜
- 9ì›” 1ëª…: ê°•ë¯¼ìˆ˜

**ì‹¤í–‰**:
```bash
python3 scripts/test/test_step_by_step_auto.py
```

**í™•ì¸ ì‚¬í•­**:
- ê° ë“±ë¡ í›„ ì‚¬ìš©ì ëª©ë¡ ë° ë“±ê¸‰
- ì§€ê¸‰ ê³„íš ìš”ì•½ (ë§¤ì¶œì›”, ë“±ê¸‰, íƒ€ì…, ì¶”ê°€ì§€ê¸‰ë‹¨ê³„, ìƒíƒœ)
- ì›”ë³„ ë“±ë¡ ì •ë³´ (ë“±ë¡ ìˆ˜, ìŠ¹ê¸‰ì, ì¶”ê°€ì§€ê¸‰ ëŒ€ìƒì)

---

### test_individual_registration.py
**ì„¤ëª…**: 7ì›” 3ëª… ê°œë³„ ë“±ë¡ (ì‚¬ì¥ë‹˜, ê¹€ì˜ìˆ˜, ì´ë¯¸ì˜)

**ì‹¤í–‰**:
```bash
python3 scripts/test/test_individual_registration.py
```

---

### test_august_registrations.py
**ì„¤ëª…**: 8ì›” 3ëª… ë“±ë¡ (ë°•ì² ìˆ˜, ìµœì˜í¬, ì •ë¯¼ìˆ˜)

**ì‹¤í–‰**:
```bash
python3 scripts/test/test_august_registrations.py
```

---

### test_september_one.py
**ì„¤ëª…**: 9ì›” 1ëª… ë“±ë¡ (ê°•ë¯¼ìˆ˜)

**ì‹¤í–‰**:
```bash
python3 scripts/test/test_september_one.py
```

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ (7ì›”-9ì›”)

#### 7ì›”
1. **ì‚¬ì¥ë‹˜** (ë£¨íŠ¸) â†’ F1
2. **ê¹€ì˜ìˆ˜** (ì‚¬ì¥ë‹˜ ì™¼ìª½) â†’ ì‚¬ì¥ë‹˜ F1â†’F2 ìŠ¹ê¸‰
3. **ì´ë¯¸ì˜** (ì‚¬ì¥ë‹˜ ì˜¤ë¥¸ìª½) â†’ 7ì›” ì™„ë£Œ

**ì˜ˆìƒ ê²°ê³¼**:
- ì‚¬ìš©ì: ì‚¬ì¥ë‹˜(F2), ê¹€ì˜ìˆ˜(F1), ì´ë¯¸ì˜(F1)
- ì§€ê¸‰ ê³„íš:
  - ì‚¬ì¥ë‹˜: 7ì›” F2 ê¸°ë³¸ 10íšŒ
  - ê¹€ì˜ìˆ˜: 7ì›” F1 ê¸°ë³¸ 10íšŒ
  - ì´ë¯¸ì˜: 7ì›” F1 ê¸°ë³¸ 10íšŒ

#### 8ì›”
1. **ë°•ì² ìˆ˜** (ê¹€ì˜ìˆ˜ ì™¼ìª½) â†’ 7ì›” ì¶”ê°€ì§€ê¸‰ ìƒì„±
2. **ìµœì˜í¬** (ê¹€ì˜ìˆ˜ ì˜¤ë¥¸ìª½) â†’ ê¹€ì˜ìˆ˜ F1â†’F2 ìŠ¹ê¸‰
3. **ì •ë¯¼ìˆ˜** (ì´ë¯¸ì˜ ì™¼ìª½) â†’ 8ì›” ì™„ë£Œ

**ì˜ˆìƒ ê²°ê³¼**:
- ì‚¬ìš©ì: ì‚¬ì¥ë‹˜(F2), ê¹€ì˜ìˆ˜(F2), ì´ë¯¸ì˜(F1), ë°•ì² ìˆ˜(F1), ìµœì˜í¬(F1), ì •ë¯¼ìˆ˜(F1)
- ì¶”ê°€ ì§€ê¸‰ ê³„íš:
  - ì‚¬ì¥ë‹˜: 8ì›” F2 ì¶”ê°€ 10íšŒ (7ì›” ë§¤ì¶œ)
  - ê¹€ì˜ìˆ˜: 8ì›” F2 ê¸°ë³¸ 10íšŒ (ìŠ¹ê¸‰) + 8ì›” F1 ì¶”ê°€ 10íšŒ (7ì›” ë§¤ì¶œ)
  - ì´ë¯¸ì˜: 8ì›” F1 ì¶”ê°€ 10íšŒ (7ì›” ë§¤ì¶œ)

#### 9ì›”
1. **ê°•ë¯¼ìˆ˜** (ì´ë¯¸ì˜ ì˜¤ë¥¸ìª½) â†’ ì´ë¯¸ì˜ F1â†’F2, ì‚¬ì¥ë‹˜ F2â†’F3 ìŠ¹ê¸‰

**ì˜ˆìƒ ê²°ê³¼**:
- ì‚¬ìš©ì: ì‚¬ì¥ë‹˜(F3), ê¹€ì˜ìˆ˜(F2), ì´ë¯¸ì˜(F2), ë°•ì² ìˆ˜(F1), ìµœì˜í¬(F1), ì •ë¯¼ìˆ˜(F1), ê°•ë¯¼ìˆ˜(F1)
- ì¶”ê°€ ì§€ê¸‰ ê³„íš:
  - ì´ë¯¸ì˜: 9ì›” F2 ê¸°ë³¸ 10íšŒ (ìŠ¹ê¸‰) + 8ì›” F1 ì¶”ê°€ ë¶€ë¶„ ì¤‘ë‹¨ (9ì›” pending, 10ì›”~ canceled)
  - ì‚¬ì¥ë‹˜: 9ì›” F3 ê¸°ë³¸ 10íšŒ (ìŠ¹ê¸‰) + 8ì›” F2 ì¶”ê°€ ë¶€ë¶„ ì¤‘ë‹¨
  - ë°•ì² ìˆ˜, ìµœì˜í¬, ì •ë¯¼ìˆ˜: 9ì›” F1 ì¶”ê°€ 10íšŒ (8ì›” ë§¤ì¶œ)

---

## DB ì§ì ‘ í™•ì¸

### MongoDB ì ‘ì†
```bash
mongosh mongodb://localhost:27017/nanumpay
```

### ìœ ìš©í•œ ì¿¼ë¦¬

#### ì‚¬ìš©ì ëª©ë¡ ë° ë“±ê¸‰
```javascript
db.users.find({}, {userName: 1, grade: 1, _id: 0})
```

#### ì§€ê¸‰ ê³„íš ìš”ì•½
```javascript
db.weeklypaymentplans.find({}, {
  userName: 1,
  revenueMonth: 1,
  baseGrade: 1,
  installmentType: 1,
  ì¶”ê°€ì§€ê¸‰ë‹¨ê³„: 1,
  planStatus: 1,
  _id: 0
}).sort({userName: 1, revenueMonth: 1})
```

#### íŠ¹ì • ì‚¬ìš©ì ì§€ê¸‰ ê³„íš ìƒì„¸
```javascript
db.weeklypaymentplans.find({
  userName: 'ì´ë¯¸ì˜'
}).forEach(plan => {
  print('\në§¤ì¶œì›”:', plan.revenueMonth);
  print('ë“±ê¸‰:', plan.baseGrade);
  print('íƒ€ì…:', plan.installmentType);
  print('ì¶”ê°€ì§€ê¸‰ë‹¨ê³„:', plan.ì¶”ê°€ì§€ê¸‰ë‹¨ê³„);
  print('íšŒì°¨ ìƒíƒœ:');
  plan.installments.forEach(inst => {
    const date = new Date(inst.scheduledDate).toISOString().split('T')[0];
    print('  -', date, ':', inst.status);
  });
});
```

#### ì›”ë³„ ë“±ë¡ ì •ë³´
```javascript
db.monthlyregistrations.find({}).forEach(mr => {
  print('\nì›”:', mr.monthKey);
  print('ë“±ë¡ ìˆ˜:', mr.registrationCount);
  if (mr.paymentTargets) {
    if (mr.paymentTargets.promoted) {
      print('ìŠ¹ê¸‰ì:', mr.paymentTargets.promoted.length);
    }
    if (mr.paymentTargets.additionalPayments) {
      print('ì¶”ê°€ì§€ê¸‰:', mr.paymentTargets.additionalPayments.length);
    }
  }
});
```

---

## ì•Œë ¤ì§„ ì´ìŠˆ (2025-10-14 ê¸°ì¤€)

### ğŸ”´ ì´ìŠˆ 1: ê¹€ì˜ìˆ˜ 8ì›” ì¶”ê°€ì§€ê¸‰ ê³„íš ì‚¬ë¼ì§
**ë°œìƒ ì‹œì **: 8ì›” 2ëª…(ìµœì˜í¬) ë“±ë¡ ì‹œ

**ì¦ìƒ**: ê¹€ì˜ìˆ˜ F1â†’F2 ìŠ¹ê¸‰ ì‹œ 8ì›” F1 ì¶”ê°€ì§€ê¸‰ ê³„íšì´ ì‚­ì œë¨

**ìƒíƒœ**: âš ï¸ ë¶„ì„ ì¤‘

### ğŸ”´ ì´ìŠˆ 2: ê¹€ì˜ìˆ˜ ìŠ¹ê¸‰ì´ paymentTargets.promotedì— ê¸°ë¡ ì•ˆ ë¨
**ë°œìƒ ì‹œì **: 8ì›” 2ëª…(ìµœì˜í¬) ë“±ë¡ ì‹œ

**ì¦ìƒ**: MonthlyRegistrationsì˜ paymentTargets.promotedì— ê¹€ì˜ìˆ˜ê°€ ê¸°ë¡ë˜ì§€ ì•ŠìŒ

**ìƒíƒœ**: âš ï¸ ë¶„ì„ ì¤‘

---

## ì°¸ê³  ë¬¸ì„œ

- [CLAUDE6.md](../../CLAUDE6.md): ì„¸ì…˜ 6 ì‘ì—… ìƒì„¸ ê¸°ë¡
- [CLAUDE.md](../../CLAUDE.md): í”„ë¡œì íŠ¸ ì „ì²´ ì»¨í…ìŠ¤íŠ¸
- [docs/ì‹œìŠ¤í…œ_ì„¤ê³„_ë¬¸ì„œ_v7.md](../../docs/ì‹œìŠ¤í…œ_ì„¤ê³„_ë¬¸ì„œ_v7.md): v7.0 ì„¤ê³„ ë¬¸ì„œ

---

**ì‘ì„±ì¼**: 2025-10-14
**ì‘ì„±ì**: Claude
