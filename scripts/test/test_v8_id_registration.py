#!/usr/bin/env python3
"""
v8.0 ID ê¸°ë°˜ ê³„ì • ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:
1ë‹¨ê³„: ê¸°ë³¸ 3ëª… ë“±ë¡ (ì‚¬ì¥ë‹˜, ê¹€ì˜ìˆ˜, ì´ë¯¸ì˜)
2ë‹¨ê³„: ë‹¤ì¤‘ ë“±ë¡ 8ëª… (ë°•ì² ìˆ˜Ã—4, ì¡°ë™í˜„Ã—4)

ë°ì´í„° íŠ¹ì§•:
- ë°•ì² ìˆ˜: 4ê°œ ë‹¤ë¥¸ ìš©ì—­ ê³„ì•½ (ë‹¤ë¥¸ íŒë§¤ì¸, ì„¤ê³„ì‚¬, ë³´í—˜)
- ì¡°ë™í˜„: 4ê°œ ë‹¤ë¥¸ ìš©ì—­ ê³„ì•½ (ë‹¤ë¥¸ íŒë§¤ì¸, ì„¤ê³„ì‚¬, ë³´í—˜)
"""

import requests
import json
import sys

BASE_URL = "http://localhost:3101"

def login():
    """ê´€ë¦¬ì ë¡œê·¸ì¸"""
    response = requests.post(
        f"{BASE_URL}/api/auth/login",
        json={
            "loginId": "ê´€ë¦¬ì",
            "password": "admin1234!!"
        }
    )
    if response.status_code == 200:
        print("âœ… ë¡œê·¸ì¸ ì„±ê³µ")
        return response.cookies
    else:
        print(f"âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: {response.status_code}")
        print(response.text)
        return None

def register_user(cookies, user_data, step_info=""):
    """ê°œë³„ ì‚¬ìš©ì ë“±ë¡"""
    print(f"\n{'='*80}")
    print(f"ğŸ“ ë“±ë¡ ì‹œì‘{step_info}: {user_data['name']} (ID: {user_data.get('ID', 'N/A')})")
    print(f"{'='*80}")

    response = requests.post(
        f"{BASE_URL}/api/admin/users/register",
        json=user_data,
        cookies=cookies
    )

    if response.status_code == 200:
        result = response.json()
        print(f"âœ… ë“±ë¡ ì„±ê³µ: {user_data['name']}")
        print(f"   ë“±ê¸‰: {result.get('user', {}).get('grade', 'N/A')}")

        # ì•Œë¦¼ ë©”ì‹œì§€ ì¶œë ¥
        if 'alerts' in result:
            for alert in result['alerts']:
                print(f"   {alert.get('message', '')}")

        return True
    else:
        print(f"âŒ ë“±ë¡ ì‹¤íŒ¨: {response.status_code}")
        print(response.text)
        return False

# ========================================
# 1ë‹¨ê³„: ê¸°ë³¸ 3ëª… ë“±ë¡
# ========================================

def step1_register_basic_3():
    """1ë‹¨ê³„: ê¸°ë³¸ 3ëª… ë“±ë¡ (ì‚¬ì¥ë‹˜, ê¹€ì˜ìˆ˜, ì´ë¯¸ì˜)"""
    print("\n" + "="*80)
    print("ğŸš€ 1ë‹¨ê³„: ê¸°ë³¸ 3ëª… ë“±ë¡ ì‹œì‘")
    print("="*80)

    cookies = login()
    if not cookies:
        return False

    users = [
        # 1. ì‚¬ì¥ë‹˜ (ë£¨íŠ¸)
        {
            "registrationDate": "2025-07-01",
            "ID": "ì‚¬ì¥ë‹˜",  # â­ v8.0: ID í•„ë“œ
            "name": "ì‚¬ì¥ë‹˜",
            "phone": "010-1234-5678",
            "idNumber": "750315-1234567",
            "bank": "êµ­ë¯¼ì€í–‰",
            "accountNumber": "123456789012",
            "íŒë§¤ì¸": "-",
            "íŒë§¤ì¸ ì—°ë½ì²˜": "010-0000-0000",
            "ì„¤ê³„ì‚¬": "ë°•ê¸°íš",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜": "010-1111-0001",
            "ë³´í—˜ìƒí’ˆëª…":"ì¢…ì‹ ë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"ì‚¼ì„±ìƒëª…",
            "ì§€ì‚¬":"ì„œìš¸ì¤‘ì•™ì§€ì‚¬"
        },
        # 2. ê¹€ì˜ìˆ˜ (ì‚¬ì¥ë‹˜ ì™¼ìª½)
        {
            "registrationDate": "2025-07-01",
            "ID": "ê¹€ì˜ìˆ˜",
            "name": "ê¹€ì˜ìˆ˜",
            "phone": "010-1234-5678",
            "idNumber": "750315-1234567",
            "bank": "êµ­ë¯¼ì€í–‰",
            "accountNumber": "123456789012",
            "íŒë§¤ì¸":"ì‚¬ì¥ë‹˜",
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-0000-0000",
            "ì„¤ê³„ì‚¬":"ë°•ê¸°íš",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0001",
            "ë³´í—˜ìƒí’ˆëª…":"ì¢…ì‹ ë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"ì‚¼ì„±ìƒëª…",
            "ì§€ì‚¬":"ì„œìš¸ì¤‘ì•™ì§€ì‚¬"
        },
        # 3. ì´ë¯¸ì˜ (ì‚¬ì¥ë‹˜ ì˜¤ë¥¸ìª½)
        {
            "registrationDate": "2025-07-02",
            "ID": "ì´ë¯¸ì˜",
            "name": "ì´ë¯¸ì˜",
            "phone": "010-2345-6789",
            "idNumber": "800422-2345678",
            "bank": "ì‹ í•œì€í–‰",
            "accountNumber": "234567890123",
            "íŒë§¤ì¸":"ì‚¬ì¥ë‹˜",
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-0000-0000",
            "ì„¤ê³„ì‚¬":"ê¹€ì„¤ê³„",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0002",
            "ë³´í—˜ìƒí’ˆëª…":"ì—°ê¸ˆë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"í•œí™”ìƒëª…",
            "ì§€ì‚¬":"ê°•ë‚¨ì§€ì‚¬"
        }
    ]

    for i, user in enumerate(users, 1):
        if not register_user(cookies, user, f" [1ë‹¨ê³„ {i}/3]"):
            return False
        print("="*80)

    print("\nâœ… 1ë‹¨ê³„ ì™„ë£Œ: ê¸°ë³¸ 3ëª… ë“±ë¡ ì„±ê³µ!")
    print("="*80)
    return True

# ========================================
# 2ë‹¨ê³„: ë‹¤ì¤‘ ë“±ë¡ 8ëª… (ë°•ì² ìˆ˜Ã—4, ì¡°ë™í˜„Ã—4)
# ========================================

def step2_register_multiple_8():
    """2ë‹¨ê³„: ë‹¤ì¤‘ ë“±ë¡ 8ëª… (ë°•ì² ìˆ˜Ã—4, ì¡°ë™í˜„Ã—4)"""
    print("\n" + "="*80)
    print("ğŸš€ 2ë‹¨ê³„: ë‹¤ì¤‘ ë“±ë¡ 8ëª… ì‹œì‘ (ë°•ì² ìˆ˜Ã—4, ì¡°ë™í˜„Ã—4)")
    print("="*80)

    cookies = login()
    if not cookies:
        return False

    users = [
        # ë°•ì² ìˆ˜ 1ì°¨ (ê¹€ì˜ìˆ˜ ì™¼ìª½)
        {
            "registrationDate": "2025-07-03",
            "ID": "ë°•ì² ìˆ˜",
            "name": "ë°•ì² ìˆ˜",
            "phone": "010-3456-7890",
            "idNumber": "700815-1456789",
            "bank": "í•˜ë‚˜ì€í–‰",
            "accountNumber": "345678901234",
            "íŒë§¤ì¸":"ê¹€ì˜ìˆ˜",
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-1234-5678",
            "ì„¤ê³„ì‚¬":"ì´ê¸°íš",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0003",
            "ë³´í—˜ìƒí’ˆëª…":"ë³€ì•¡ë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"êµë³´ìƒëª…",
            "ì§€ì‚¬":"ë¶€ì‚°ì§€ì‚¬"
        },
        # ë°•ì² ìˆ˜ 2ì°¨ (ê¹€ì˜ìˆ˜ ì˜¤ë¥¸ìª½) - ë‹¤ë¥¸ ì„¤ê³„ì‚¬, ë‹¤ë¥¸ ë³´í—˜
        {
            "registrationDate": "2025-07-04",
            "ID": "ë°•ì² ìˆ˜",  # â­ ë™ì¼ ID
            "name": "ë°•ì² ìˆ˜",
            "phone": "010-4567-8901",  # ë‹¤ë¥¸ ì „í™”ë²ˆí˜¸ (ë¬´ì‹œë¨)
            "idNumber": "850920-2567890",  # ë‹¤ë¥¸ ì£¼ë¯¼ë²ˆí˜¸ (ë¬´ì‹œë¨)
            "bank": "ìš°ë¦¬ì€í–‰",  # ë‹¤ë¥¸ ì€í–‰ (ë¬´ì‹œë¨)
            "accountNumber": "456789012345",  # ë‹¤ë¥¸ ê³„ì¢Œ (ë¬´ì‹œë¨)
            "íŒë§¤ì¸":"ê¹€ì˜ìˆ˜",
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-1234-5678",
            "ì„¤ê³„ì‚¬":"ì •ì„¤ê³„",  # â­ ë‹¤ë¥¸ ì„¤ê³„ì‚¬
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0004",
            "ë³´í—˜ìƒí’ˆëª…":"ê±´ê°•ë³´í—˜",  # â­ ë‹¤ë¥¸ ë³´í—˜
            "ë³´í—˜íšŒì‚¬":"KBìƒëª…",
            "ì§€ì‚¬":"ëŒ€êµ¬ì§€ì‚¬"
        },
        # ë°•ì² ìˆ˜ 3ì°¨ (ì´ë¯¸ì˜ ì™¼ìª½) - ë˜ ë‹¤ë¥¸ ì„¤ê³„ì‚¬, ë³´í—˜
        {
            "registrationDate": "2025-07-05",
            "ID": "ë°•ì² ìˆ˜",  # â­ ë™ì¼ ID
            "name": "ë°•ì² ìˆ˜",
            "phone": "010-5678-9012",  # ë¬´ì‹œë¨
            "idNumber": "770525-1678901",  # ë¬´ì‹œë¨
            "bank": "ë†í˜‘ì€í–‰",  # ë¬´ì‹œë¨
            "accountNumber": "567890123456",  # ë¬´ì‹œë¨
            "íŒë§¤ì¸":"ì´ë¯¸ì˜",  # â­ ë‹¤ë¥¸ íŒë§¤ì¸
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-2345-6789",
            "ì„¤ê³„ì‚¬":"ìµœê¸°íš",  # â­ ë‹¤ë¥¸ ì„¤ê³„ì‚¬
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0005",
            "ë³´í—˜ìƒí’ˆëª…":"ì•”ë³´í—˜",  # â­ ë‹¤ë¥¸ ë³´í—˜
            "ë³´í—˜íšŒì‚¬":"ë™ì–‘ìƒëª…",
            "ì§€ì‚¬":"ê´‘ì£¼ì§€ì‚¬"
        },
        # ë°•ì² ìˆ˜ 4ì°¨ (ì´ë¯¸ì˜ ì˜¤ë¥¸ìª½)
        {
            "registrationDate": "2025-07-08",
            "ID": "ë°•ì² ìˆ˜",  # â­ ë™ì¼ ID
            "name": "ë°•ì² ìˆ˜",
            "phone": "010-6789-0123",  # ë¬´ì‹œë¨
            "idNumber": "900612-2789012",  # ë¬´ì‹œë¨
            "bank": "êµ­ë¯¼ì€í–‰",  # ë¬´ì‹œë¨
            "accountNumber": "678901234567",  # ë¬´ì‹œë¨
            "íŒë§¤ì¸":"ì´ë¯¸ì˜",
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-2345-6789",
            "ì„¤ê³„ì‚¬":"ë°•ê¸°íš",  # ê¸°ì¡´ ì„¤ê³„ì‚¬ ì¬í™œìš©
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0001",
            "ë³´í—˜ìƒí’ˆëª…":"ì¢…ì‹ ë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"ì‚¼ì„±ìƒëª…",
            "ì§€ì‚¬":"ì„œìš¸ì¤‘ì•™ì§€ì‚¬"
        },

        # ì¡°ë™í˜„ 1ì°¨ (ë°•ì² ìˆ˜ ì™¼ìª½)
        {
            "registrationDate": "2025-07-09",
            "ID": "ì¡°ë™í˜„",
            "name": "ì¡°ë™í˜„",
            "phone": "010-7890-1234",
            "idNumber": "881225-1890123",
            "bank": "ì‹ í•œì€í–‰",
            "accountNumber": "789012345678",
            "íŒë§¤ì¸":"ë°•ì² ìˆ˜",  # â­ ë°•ì² ìˆ˜ (UserAccount.loginId)
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-3456-7890",
            "ì„¤ê³„ì‚¬":"ë°•ê¸°íš",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0001",
            "ë³´í—˜ìƒí’ˆëª…":"ì¢…ì‹ ë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"ì‚¼ì„±ìƒëª…",
            "ì§€ì‚¬":"ì„œìš¸ì¤‘ì•™ì§€ì‚¬"
        },
        # ì¡°ë™í˜„ 2ì°¨
        {
            "registrationDate": "2025-07-10",
            "ID": "ì¡°ë™í˜„",  # â­ ë™ì¼ ID
            "name": "ì¡°ë™í˜„",
            "phone": "010-8901-2345",  # ë¬´ì‹œë¨
            "idNumber": "920718-2901234",  # ë¬´ì‹œë¨
            "bank": "í•˜ë‚˜ì€í–‰",  # ë¬´ì‹œë¨
            "accountNumber": "890123456789",  # ë¬´ì‹œë¨
            "íŒë§¤ì¸":"ë°•ì² ìˆ˜",
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-3456-7890",
            "ì„¤ê³„ì‚¬":"ê¹€ì„¤ê³„",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0002",
            "ë³´í—˜ìƒí’ˆëª…":"ì—°ê¸ˆë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"í•œí™”ìƒëª…",
            "ì§€ì‚¬":"ê°•ë‚¨ì§€ì‚¬"
        },
        # ì¡°ë™í˜„ 3ì°¨
        {
            "registrationDate": "2025-07-11",
            "ID": "ì¡°ë™í˜„",  # â­ ë™ì¼ ID
            "name": "ì¡°ë™í˜„",
            "phone": "010-9012-3456",  # ë¬´ì‹œë¨
            "idNumber": "860830-1012345",  # ë¬´ì‹œë¨
            "bank": "ìš°ë¦¬ì€í–‰",  # ë¬´ì‹œë¨
            "accountNumber": "901234567890",  # ë¬´ì‹œë¨
            "íŒë§¤ì¸":"ë°•ì² ìˆ˜2",  # â­ User.name (ë°•ì² ìˆ˜ 2ì°¨)
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-4567-8901",
            "ì„¤ê³„ì‚¬":"ê¹€ì„¤ê³„",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0002",
            "ë³´í—˜ìƒí’ˆëª…":"ì—°ê¸ˆë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"í•œí™”ìƒëª…",
            "ì§€ì‚¬":"ê°•ë‚¨ì§€ì‚¬"
        },
        # ì¡°ë™í˜„ 4ì°¨
        {
            "registrationDate": "2025-07-12",
            "ID": "ì¡°ë™í˜„",  # â­ ë™ì¼ ID
            "name": "ì¡°ë™í˜„",
            "phone": "010-0123-4567",  # ë¬´ì‹œë¨
            "idNumber": "910405-2123456",  # ë¬´ì‹œë¨
            "bank": "ë†í˜‘ì€í–‰",  # ë¬´ì‹œë¨
            "accountNumber": "012345678901",  # ë¬´ì‹œë¨
            "íŒë§¤ì¸":"ë°•ì² ìˆ˜2",  # User.name
            "íŒë§¤ì¸ ì—°ë½ì²˜":"010-4567-8901",
            "ì„¤ê³„ì‚¬":"ì´ê¸°íš",
            "ì„¤ê³„ì‚¬ ì—°ë½ì²˜":"010-1111-0003",
            "ë³´í—˜ìƒí’ˆëª…":"ë³€ì•¡ë³´í—˜",
            "ë³´í—˜íšŒì‚¬":"êµë³´ìƒëª…",
            "ì§€ì‚¬":"ë¶€ì‚°ì§€ì‚¬"
        }
    ]

    for i, user in enumerate(users, 1):
        user_desc = user['name']
        if user['ID'] in ['ë°•ì² ìˆ˜', 'ì¡°ë™í˜„']:
            # ê°™ì€ ID ê°œìˆ˜ ì„¸ê¸°
            count = sum(1 for u in users[:i] if u['ID'] == user['ID'])
            user_desc = f"{user['name']} {count}ì°¨"

        if not register_user(cookies, user, f" [2ë‹¨ê³„ {i}/8: {user_desc}]"):
            return False
        print("="*80)

    print("\nâœ… 2ë‹¨ê³„ ì™„ë£Œ: ë‹¤ì¤‘ ë“±ë¡ 8ëª… ì„±ê³µ!")
    print("="*80)
    return True

# ========================================
# ì „ì²´ í…ŒìŠ¤íŠ¸
# ========================================

def test_all():
    """ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰"""
    print("\n" + "="*80)
    print("ğŸš€ v8.0 ID ê¸°ë°˜ ê³„ì • ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘")
    print("="*80)

    # 1ë‹¨ê³„: ê¸°ë³¸ 3ëª…
    if not step1_register_basic_3():
        print("\nâŒ 1ë‹¨ê³„ ì‹¤íŒ¨!")
        return False

    print("\nâ¸ï¸  1ë‹¨ê³„ ì™„ë£Œ. 2ë‹¨ê³„ë¥¼ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")
    input()

    # 2ë‹¨ê³„: ë‹¤ì¤‘ ë“±ë¡ 8ëª…
    if not step2_register_multiple_8():
        print("\nâŒ 2ë‹¨ê³„ ì‹¤íŒ¨!")
        return False

    print("\n" + "="*80)
    print("âœ… ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
    print("="*80)
    print("\nğŸ“Š ì˜ˆìƒ ê²°ê³¼:")
    print("  - UserAccount: 5ê°œ (ì‚¬ì¥ë‹˜, ê¹€ì˜ìˆ˜, ì´ë¯¸ì˜, ë°•ì² ìˆ˜, ì¡°ë™í˜„)")
    print("  - User: 11ê°œ (ì‚¬ì¥ë‹˜, ê¹€ì˜ìˆ˜, ì´ë¯¸ì˜, ë°•ì² ìˆ˜Ã—4, ì¡°ë™í˜„Ã—4)")
    print("  - PlannerAccount: 5ê°œ (ë°•ê¸°íš, ê¹€ì„¤ê³„, ì´ê¸°íš, ì •ì„¤ê³„, ìµœê¸°íš)")
    print("\nğŸ“ ë‹¤ìŒ ë‹¨ê³„:")
    print("  1. MongoDB í™•ì¸: mongosh mongodb://localhost:27017/nanumpay")
    print("     > db.useraccounts.count()  // 5")
    print("     > db.users.count()  // 11")
    print("     > db.planneraccounts.count()  // 5")
    print("  2. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸:")
    print("     - ë°•ì² ìˆ˜ (1234) â†’ 4ê°œ ìš©ì—­ í™•ì¸")
    print("     - ì¡°ë™í˜„ (1234) â†’ 4ê°œ ìš©ì—­ í™•ì¸")
    print("     - ë°•ê¸°íš (0001) â†’ ë‹´ë‹¹ ìš©ì—­ì í™•ì¸")

    return True

# ========================================
# ë©”ì¸
# ========================================

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    if len(sys.argv) < 2:
        # ê¸°ë³¸: ì „ì²´ í…ŒìŠ¤íŠ¸
        test_all()
        return

    command = sys.argv[1]

    if command == "all":
        test_all()
    elif command == "step1" or command == "1":
        step1_register_basic_3()
    elif command == "step2" or command == "2":
        step2_register_multiple_8()
    else:
        print(f"âŒ ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´: {command}")
        print("\nì‚¬ìš©ë²•:")
        print("  python3 test_v8_id_registration.py           # ì „ì²´ í…ŒìŠ¤íŠ¸ (ê¸°ë³¸)")
        print("  python3 test_v8_id_registration.py all       # ì „ì²´ í…ŒìŠ¤íŠ¸")
        print("  python3 test_v8_id_registration.py step1     # 1ë‹¨ê³„ë§Œ (ê¸°ë³¸ 3ëª…)")
        print("  python3 test_v8_id_registration.py step2     # 2ë‹¨ê³„ë§Œ (ë‹¤ì¤‘ 8ëª…)")

if __name__ == "__main__":
    main()
